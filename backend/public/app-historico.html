<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#6A0DAD">
<title>📊 Histórico Premium - Vivo</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="/css/vivo-global.css">
</head>
<body>
<div class="header">
<div class="header-content">
<button class="back-btn" onclick="window.history.back()">
<i class="fas fa-arrow-left"></i>
</button>
<h1>📊 Histórico Premium</h1>
</div>
</div>
<div class="stats-cards">
<div class="stat-card">
<div class="stat-value" id="totalGanho">0</div>
<div class="stat-label">💰 Ganhos</div>
</div>
<div class="stat-card">
<div class="stat-value" id="totalResgate">0</div>
<div class="stat-label">🎁 Resgates</div>
</div>
<div class="stat-card">
<div class="stat-value" id="totalTransacoes">0</div>
<div class="stat-label">📈 Transações</div>
</div>
</div>
<div class="filter-tabs">
<div class="filter-tab active" data-filter="todos" onclick="filtrar('todos')">
<i class="fas fa-list"></i> Todos
        </div>
<div class="filter-tab" data-filter="ganho" onclick="filtrar('ganho')">
<i class="fas fa-plus-circle"></i> Ganhos
        </div>
<div class="filter-tab" data-filter="resgate" onclick="filtrar('resgate')">
<i class="fas fa-gift"></i> Resgates
        </div>
<div class="filter-tab" data-filter="expiracao" onclick="filtrar('expiracao')">
<i class="fas fa-clock"></i> Expirações
        </div>
</div>
<div class="timeline" id="timeline"></div>
<div class="empty-state" id="emptyState" style="display: none;">
<i class="fas fa-history"></i>
<p>Nenhuma transação encontrada</p>
</div>
<nav class="bottom-nav">
<div class="nav-items">
<a href="/app-inicio.html" class="nav-item">
<i class="fas fa-home"></i>
<span>Início</span>
</a>
<a href="/app-empresas.html" class="nav-item">
<i class="fas fa-search"></i>
<span>Buscar</span>
</a>
<a href="/app-cupons.html" class="nav-item">
<i class="fas fa-ticket-alt"></i>
<span>Cupons</span>
</a>
<a href="/app-pontos.html" class="nav-item active">
<i class="fas fa-coins"></i>
<span>Pontos</span>
</a>
<a href="/app-perfil.html" class="nav-item">
<i class="fas fa-user"></i>
<span>Perfil</span>
</a>
</div>
</nav>
<script>
        const API_BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:8001' : 'https://tem-de-tudo.onrender.com';
        let historico = [];
        let filtroAtual = 'todos';
        
        const icones = {
            ganho: 'fa-plus-circle',
            checkin: 'fa-check-circle',
            resgate: 'fa-gift',
            expiracao: 'fa-clock'
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'entrar.html';
                return;
            }
            await carregarHistorico();
        });

        async function carregarHistorico() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/historico`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    historico = data.data;
                    calcularEstatisticas();
                    renderizarHistorico();
                } else {
                    // Dados mockados para demonstração
                    historico = [
                        {
                            tipo: 'ganho',
                            pontos: 100,
                            descricao: 'Check-in Premium',
                            empresa: 'Loja ABC',
                            created_at: new Date().toISOString()
                        },
                        {
                            tipo: 'resgate',
                            pontos: -50,
                            descricao: 'Cupom de desconto resgatado',
                            empresa: 'Super Mercado',
                            created_at: new Date(Date.now() - 86400000).toISOString()
                        }
                    ];
                    calcularEstatisticas();
                    renderizarHistorico();
                }
            } catch (error) {
                console.error('Erro ao carregar histórico:', error);
                mostrarFeedback('Erro ao carregar histórico', 'error');
            }
        }

        function calcularEstatisticas() {
            const ganhos = historico.filter(h => h.tipo === 'ganho' || h.tipo === 'checkin')
                .reduce((sum, h) => sum + (h.pontos || 0), 0);
            
            const resgates = historico.filter(h => h.tipo === 'resgate')
                .reduce((sum, h) => sum + Math.abs(h.pontos || 0), 0);

            document.getElementById('totalGanho').textContent = ganhos;
            document.getElementById('totalResgate').textContent = resgates;
            document.getElementById('totalTransacoes').textContent = historico.length;
        }

        function filtrar(tipo) {
            filtroAtual = tipo;
            
            // Atualizar tabs ativas
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-filter="${tipo}"]`).classList.add('active');
            
            renderizarHistorico();
        }

        function renderizarHistorico() {
            let dados = historico;
            
            if (filtroAtual !== 'todos') {
                dados = historico.filter(h => h.tipo === filtroAtual);
            }

            const timeline = document.getElementById('timeline');
            const empty = document.getElementById('emptyState');

            if (dados.length === 0) {
                timeline.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            timeline.style.display = 'block';
            empty.style.display = 'none';

            timeline.innerHTML = dados.map(h => `
                <div class="timeline-item">
<div class="timeline-icon ${h.tipo}">
<i class="fas ${icones[h.tipo] || 'fa-circle'}"></i>
</div>
<div class="timeline-content">
<div class="timeline-header">
<div class="timeline-title">${h.descricao || h.tipo}</div>
<div class="timeline-points ${h.pontos > 0 ? 'positive' : 'negative'}">
                                ${h.pontos > 0 ? '+' : ''}${h.pontos} pts
                            </div>
</div>
<div class="timeline-desc">🏪 ${h.empresa || 'Sistema'}</div>
<div class="timeline-date">📅 ${new Date(h.created_at).toLocaleString('pt-BR')}</div>
</div>
</div>
            `).join('');
        }

        function mostrarFeedback(mensagem, tipo) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${tipo === 'success' ? 'linear-gradient(135deg, #00d4aa, #00c896)' : tipo === 'error' ? 'linear-gradient(135deg, #ff6b6b, #ff5252)' : 'linear-gradient(135deg, #6F1AB6, #9333EA)'};
                color: ${tipo === 'success' || tipo === 'error' ? '#fff' : '#0a0a0f'};
                padding: 12px 24px;
                border-radius: 16px;
                font-weight: 600;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
                animation: slideDown 0.3s ease;
            `;
            
            feedback.textContent = mensagem;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => document.body.removeChild(feedback), 300);
            }, 3000);
        }

        // Estilos para animações
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translate(-50%, -100%); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translate(-50%, 0); opacity: 1; }
                to { transform: translate(-50%, -100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>







