<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6A0DAD">
    <title>Gerenciar Empresas - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/css/vivo-global.css">
    <link rel="manifest" href="/manifest.json">
    <script src="/js/config.js"></script>
</head>
<body>
    <div class="admin-header">
        <div class="header-content">
            <h1><i class="fas fa-building"></i> Gerenciar Empresas</h1>
            <button class="btn-secondary" onclick="history.back()" style="background:rgba(255,255,255,0.15);color:white;border:1px solid rgba(255,255,255,0.3);"><i class="fas fa-arrow-left"></i> Voltar</button>
        </div>
    </div>
    <div class="main">
        <div class="section">
            <div class="section-header">
                <div class="section-title">Todas as Empresas</div>
                <button class="btn-primary" style="font-size:13px;padding:8px 14px;" onclick="createEmpresa()"><i class="fas fa-plus"></i> Nova</button>
            </div>
            <div class="search-box" style="margin-bottom:16px;">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Buscar por nome, CNPJ ou categoria..." oninput="filterEmpresas(this.value)">
            </div>
            <div class="table-container">
                <table>
                    <thead><tr><th>Logo</th><th>Nome</th><th>CNPJ</th><th>Categoria</th><th>Status</th><th>AÃ§Ãµes</th></tr></thead>
                    <tbody id="empresasTable"><tr><td colspan="6" style="text-align:center;padding:40px;color:#86868b;">Carregando...</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>
    <nav class="bottom-nav">
        <a href="/admin-painel.html" class="nav-item "><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        <a href="/admin-usuarios.html" class="nav-item "><i class="fas fa-users"></i><span>UsuÃ¡rios</span></a>
        <a href="/admin-empresas.html" class="nav-item active"><i class="fas fa-building"></i><span>Empresas</span></a>
        <a href="/admin-relatorios.html" class="nav-item "><i class="fas fa-chart-line"></i><span>RelatÃ³rios</span></a>
        <a href="/admin-configuracoes.html" class="nav-item "><i class="fas fa-cog"></i><span>Config</span></a>
    </nav>
    <script>
        let allEmpresas = [];
        async function loadEmpresas() {
            try {
                const token = localStorage.getItem('token');
                if (!token) { window.location.href = '/admin-login.html'; return; }
                const r = await fetch(API_CONFIG.getBaseURL() + '/api/empresas', { headers: { 'Authorization': 'Bearer ' + token, 'Accept': 'application/json' }});
                if (r.ok) { const j = await r.json(); allEmpresas = j.data || j || []; renderEmpresas(allEmpresas); }
                else if (r.status === 401) { window.location.href = '/admin-login.html'; }
            } catch(e) { console.error(e); renderEmpresas([]); }
        }
        function filterEmpresas(q) { renderEmpresas(allEmpresas.filter(e => (e.nome||e.nome_fantasia||'').toLowerCase().includes(q.toLowerCase()))); }
        function renderEmpresas(list) {
            const tbody = document.getElementById('empresasTable');
            if (!list.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:#86868b;">Nenhuma empresa encontrada</td></tr>'; return; }
            tbody.innerHTML = list.map(e => <tr>
                <td><img src="" alt="" style="width:38px;height:38px;border-radius:8px;object-fit:cover;"></td>
                <td></td><td></td><td></td>
                <td><span class="badge badge-"></span></td>
                <td style="display:flex;gap:6px;">
                    <button class="btn-secondary" style="font-size:12px;padding:6px 10px;" onclick="viewEmpresa()"><i class="fas fa-eye"></i></button>
                    <button class="btn-secondary" style="font-size:12px;padding:6px 10px;" onclick="editEmpresa()"><i class="fas fa-edit"></i></button>
                    <button class="btn-secondary" style="font-size:12px;padding:6px 10px;color:#ef4444;border-color:#fca5a5;" onclick="deleteEmpresa()"><i class="fas fa-trash"></i></button>
                </td></tr>).join('');
        }
        function createEmpresa() { alert('Criar nova empresa'); }
        function viewEmpresa(id) { window.location.href = '/profile-company.html?id=' + id; }
        function editEmpresa(id) { alert('Editar empresa ' + id); }
        function deleteEmpresa(id) { if(confirm('Excluir empresa?')) alert('ExcluÃ­da ' + id); }
        document.addEventListener('DOMContentLoaded', loadEmpresas);
    </script>
</body>
</html>





