<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0a0a0f">
<title>Estabelecimento - Tem de Tudo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="manifest" href="/manifest.json">
<script src="/js/config.js"></script>
<script src="/js/auth-manager.js" defer></script>
<script src="/js/api-client.js" defer></script>
<script src="/js/validators.js" defer></script>
<script src="/js/ui-helpers.js" defer></script>
<script src="/js/auth-guard.js" data-require-auth="cliente"></script>
<link rel="stylesheet" href="/css/global-unified.css">
<link rel="stylesheet" href="/css/theme-escuro.css">`n    <link rel="stylesheet" href="/css/vale-bonus-theme.css">
<link rel="stylesheet" href="/css/style-unificado.css?v=3">
</head>
<body>
<div id="loading" class="loading">
<i class="fas fa-spinner fa-spin" style="font-size: 48px;"></i>
<p style="margin-top: 20px;">Carregando estabelecimento...</p>
</div>
<div id="content" style="display: none;">
<div class="hero">
<button class="back-btn" onclick="history.back()">
<i class="fas fa-arrow-left"></i>
</button>
<div class="hero-icon" id="heroIcon">??</div>
<h1 class="hero-title" id="empresaNome">Carregando...</h1>
<p class="hero-category" id="empresaCategoria">...</p>
<div class="hero-stats">
<div class="stat">
<div class="stat-value" id="empresaRating">-</div>
<div class="stat-label">Avalia��o</div>
</div>
<div class="stat">
<div class="stat-value" id="meusPontos">0</div>
<div class="stat-label">Meus Pontos</div>
</div>
<div class="stat">
<div class="stat-value" id="totalClientes">-</div>
<div class="stat-label">Clientes</div>
</div>
</div>
</div>
<div class="content">
<div class="info-card" id="sobreCard">
<div class="info-title"><i class="fas fa-info-circle"></i> Sobre</div>
<div class="info-text" id="empresaDescricao">-</div>
</div>
<div class="info-card" id="enderecoCard">
<div class="info-title"><i class="fas fa-map-marker-alt"></i> Endere�o</div>
<div class="info-text" id="empresaEndereco">-</div>
</div>
<div class="info-card" id="promocoesCard" style="display: none;">
<div class="info-title"><i class="fas fa-gift"></i> Promo��es Ativas</div>
<div class="promocoes-list" id="promocoesList"></div>
</div>
<div class="info-card" id="avaliacoesCard" style="display: none;">
<div class="info-title"><i class="fas fa-star"></i> Avalia��es Recentes</div>
<div class="reviews-list" id="reviewsList"></div>
</div>
<button class="action-btn" onclick="location.href='app-scanner.html'">
<i class="fas fa-qrcode"></i> Acumular Pontos Agora
            </button>
</div>
</div>
<script>
        let empresaId = null;
        let empresaData = null;
        
        // �cones por ramo
        const ramoIcons = {
            'restaurante': '???',
            'lanchonete': '??',
            'pizzaria': '??',
            'cafeteria': '?',
            'padaria': '??',
            'academia': '??',
            'farmacia': '??',
            'petshop': '??',
            'salao': '??',
            'mercado': '??',
            'default': '??'
        };
        
        // Pegar ID da URL
        function getEmpresaId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }
        
        // Carregar detalhes da empresa
        async function loadEmpresa() {
            empresaId = getEmpresaId();
            
            if (!empresaId) {
                alert('Empresa n�o especificada');
                history.back();
                return;
            }
            
            const token = localStorage.getItem('token');
            
            if (!token) {
                window.location.href = 'entrar.html';
                return;
            }

            try {
                const response = await fetch(`/api/cliente/empresas/${empresaId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    empresaData = result.data;
                    
                    console.log('Empresa carregada:', empresaData);
                    renderEmpresa();
                } else if (response.status === 404) {
                    alert('Empresa n�o encontrada');
                    history.back();
                } else if (response.status === 401) {
                    window.location.href = 'entrar.html';
                } else {
                    console.error('Erro na resposta:', response.status);
                    alert('Erro ao carregar empresa');
                    history.back();
                }
            } catch (error) {
                console.error('Erro ao carregar empresa:', error);
                alert('Erro ao carregar empresa');
                history.back();
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            }
        }
        
        // Renderizar empresa
        function renderEmpresa() {
            const { empresa, meus_pontos, promocoes, avaliacoes } = empresaData;
            
            // Header
            document.getElementById('empresaNome').textContent = empresa.nome;
            document.getElementById('empresaCategoria').textContent = empresa.ramo || 'Estabelecimento';
            
            // �cone/Logo
            const iconEl = document.getElementById('heroIcon');
            if (empresa.logo) {
                iconEl.innerHTML = `<img src="${empresa.logo}" alt="${empresa.nome}" onerror="this.parentElement.innerHTML='${ramoIcons[empresa.ramo] || ramoIcons.default}'">`;
            } else {
                iconEl.textContent = ramoIcons[empresa.ramo] || ramoIcons.default;
            }
            
            // Stats
            document.getElementById('empresaRating').textContent = empresa.avaliacao_media || '5.0';
            document.getElementById('meusPontos').textContent = meus_pontos || 0;
            document.getElementById('totalClientes').textContent = empresa.total_clientes || '-';
            
            // Sobre
            document.getElementById('empresaDescricao').textContent = empresa.descricao || 'Sem descri��o dispon�vel.';
            
            // Endere�o
            document.getElementById('empresaEndereco').innerHTML = `
                ${empresa.endereco || 'Endere�o n�o informado'}<br>
                ${empresa.cidade ? `${empresa.cidade}, ${empresa.estado || ''}` : ''}
            `;
            
            // Promo��es
            if (promocoes && promocoes.length > 0) {
                document.getElementById('promocoesCard').style.display = 'block';
                renderPromocoes(promocoes);
            }
            
            // Avalia��es
            if (avaliacoes && avaliacoes.length > 0) {
                document.getElementById('avaliacoesCard').style.display = 'block';
                renderAvaliacoes(avaliacoes);
            }
        }
        
        // Renderizar promo��es
        function renderPromocoes(promocoes) {
            const list = document.getElementById('promocoesList');
            
            list.innerHTML = promocoes.map(promo => {
                let badge = '';
                if (promo.pontos_necessarios) {
                    badge = `<span class="promo-badge">?? ${promo.pontos_necessarios} pts</span>`;
                }
                
                return `
                    <div class="promo-item">
<h4>${promo.nome}</h4>
<p>${promo.descricao || 'Promo��o especial!'}</p>
                        ${badge}
                    </div>
                `;
            }).join('');
        }
        
        // Renderizar avalia��es
        function renderAvaliacoes(avaliacoes) {
            const list = document.getElementById('reviewsList');
            
            list.innerHTML = avaliacoes.slice(0, 5).map(review => {
                const stars = '?'.repeat(review.nota);
                const date = new Date(review.created_at).toLocaleDateString('pt-BR');
                
                return `
                    <div class="review-item">
<div class="review-header">
<span class="review-author">${review.cliente_nome || 'An�nimo'}</span>
<span class="review-rating">${stars}</span>
</div>
                        ${review.comentario ? `<p class="review-comment">${review.comentario}</p>` : ''}
                        <p class="review-date">${date}</p>
</div>
                `;
            }).join('');
        }
        
        // Carregar ao iniciar
        document.addEventListener('DOMContentLoaded', loadEmpresa);
    </script>
<!-- Bottom Navigation -->
<nav class="bottom-nav">
<a href="/app-inicio.html" class="nav-item">
<i class="fas fa-home"></i>
<span>In�cio</span>
</a>
<a href="/app-empresas.html" class="nav-item">
<i class="fas fa-search"></i>
<span>Buscar</span>
</a>
<a href="/app-meus-pontos.html" class="nav-item">
<i class="fas fa-wallet"></i>
<span>Pontos</span>
</a>
<a href="/app-promocoes.html" class="nav-item">
<i class="fas fa-tags"></i>
<span>Promo��es</span>
</a>
<a href="/app-perfil.html" class="nav-item">
<i class="fas fa-user"></i>
<span>Perfil</span>
</a>
</nav>
</body>
</html>


