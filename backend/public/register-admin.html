<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registro de Administrador - Tem de Ponto</title>
    <meta name="description" content="P?gina de registro para administradores do sistema Tem de Ponto">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    
    <!-- Modern Theme CSS -->
    
    <script src="/js/config.js"></script>
    <script src="/js/auth-manager.js" defer></script>
    <script src="/js/api-client.js" defer></script>
    <script src="/js/validators.js" defer></script>
    <script src="/js/ui-helpers.js" defer></script>
    <script src="/js/auth-guard.js" data-require-auth="cliente"></script>
        <link rel="stylesheet" href="/css/global-unified.css">
    <link rel="stylesheet" href="/css/theme-escuro.css">`n</head>
<body>
    <div class="register-container">
        <!-- Logo Section -->
        <div class="logo-section">
            <div class="logo">
                <i class="fas fa-crown"></i>
            </div>
            <h2 style="color: var(--gray-900); margin: 0;">Registro de Administrador</h2>
            <p style="color: var(--gray-600); margin: var(--space-2) 0 0;">Sistema Tem de Ponto</p>
        </div>

        <!-- Help Box -->
        <div style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); border: 1px solid #667eea; border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-4);">
            <div style="text-align: center; margin-bottom: var(--space-3);">
                <i class="fas fa-info-circle" style="color: #1d4ed8; font-size: 1.5rem;"></i>
            </div>
            <h4 style="color: #764ba2; text-align: center; margin-bottom: var(--space-2);">?? Como Obter o Token</h4>
            <div style="color: #1e3a8a; font-size: 0.875rem;">
                <p style="margin-bottom: var(--space-2);"><strong>Op??o 1:</strong> Use um dos tokens j? dispon?veis abaixo (clique para copiar)</p>
                <p style="margin-bottom: var(--space-2);"><strong>Op??o 2:</strong> Aperte <kbd>F12</kbd> ? aba "Console" para ver os tokens</p>
                <p style="margin: 0;"><strong>Op??o 3:</strong> Use o admin de teste: <code>admin@temdeponto.com</code> (qualquer senha)</p>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <i class="fas fa-check-circle"></i>
            <h4 style="color: #065f46; margin: 0 0 var(--space-2);">Administrador Criado com Sucesso!</h4>
            <p style="color: #047857; margin: 0;">Voc? pode agora fazer login com as credenciais criadas.</p>
        </div>

        <!-- Registration Form -->
        <form id="adminRegisterForm">
            <!-- Token Section -->
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-key"></i>
                    Token de Acesso
                </div>
                <div class="token-info">
                    <strong>Tokens de Desenvolvimento Dispon?veis:</strong><br>
                    <div style="background: var(--gray-100); padding: var(--space-3); border-radius: var(--radius-md); margin-top: var(--space-2); font-family: monospace;">
                        <div style="margin-bottom: var(--space-1);"><strong>Copie um destes:</strong></div>
                        <div style="color: var(--primary-600); cursor: pointer;" onclick="copyToken('TEMDETUDO_ADMIN_2025')" title="Clique para copiar">
                            ?? TEMDETUDO_ADMIN_2025
                        </div>
                        <div style="color: var(--primary-600); cursor: pointer;" onclick="copyToken('MASTER_ACCESS_TOKEN_2025')" title="Clique para copiar">
                            ?? MASTER_ACCESS_TOKEN_2025
                        </div>
                        <div style="color: var(--primary-600); cursor: pointer;" onclick="copyToken('TDP_ADMIN_CREATE_2025')" title="Clique para copiar">
                            ?? TDP_ADMIN_CREATE_2025
                        </div>
                        <small style="color: var(--gray-500); margin-top: var(--space-2); display: block;">
                            ?? Clique em qualquer token para copiar automaticamente
                        </small>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Token de Acesso *</label>
                    <input type="password" 
                           id="accessToken" 
                           class="form-control" 
                           placeholder="Digite o token fornecido pelo desenvolvedor"
                           required>
                </div>
            </div>

            <!-- Admin Info Section -->
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-user-shield"></i>
                    Informa??es do Administrador
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nome Completo *</label>
                    <input type="text" 
                           id="adminName" 
                           class="form-control" 
                           placeholder="Seu nome completo"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" 
                           id="adminEmail" 
                           class="form-control" 
                           placeholder="admin@empresa.com"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Telefone *</label>
                    <input type="tel" 
                           id="adminPhone" 
                           class="form-control" 
                           placeholder="(11) 99999-9999"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Senha *</label>
                    <input type="password" 
                           id="adminPassword" 
                           class="form-control" 
                           placeholder="Crie uma senha segura"
                           minlength="6"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Confirmar Senha *</label>
                    <input type="password" 
                           id="confirmPassword" 
                           class="form-control" 
                           placeholder="Digite a senha novamente"
                           minlength="6"
                           required>
                </div>
            </div>

            <!-- Company Info Section -->
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-building"></i>
                    Informa??es da Empresa (opcional)
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nome da Empresa</label>
                    <input type="text" 
                           id="companyName" 
                           class="form-control" 
                           placeholder="Nome da sua empresa">
                </div>

                <div class="form-group">
                    <label class="form-label">CNPJ</label>
                    <input type="text" 
                           id="companyCnpj" 
                           class="form-control" 
                           placeholder="00.000.000/0000-00"
                           maxlength="18">
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-full">
                <i class="fas fa-user-plus icon-sm"></i>
                Criar Conta de Administrador
            </button>
        </form>

        <!-- Info Box -->
        <div style="background: linear-gradient(135deg, #e0f2fe, #b3e5fc); border: 1px solid #0288d1; border-radius: var(--radius-lg); padding: var(--space-4); margin-top: var(--space-6); text-align: center;">
            <i class="fas fa-info-circle" style="color: #0277bd; font-size: 1.5rem; margin-bottom: var(--space-2);"></i>
            <h4 style="color: #01579b; margin-bottom: var(--space-2);">?? Novo Sistema Seguro</h4>
            <p style="color: #0277bd; font-size: 0.875rem; margin-bottom: var(--space-3);">
                Agora apenas administradores logados podem criar outros administradores atrav?s do painel administrativo.
            </p>
            <div style="display: flex; gap: var(--space-3); justify-content: center; flex-wrap: wrap;">
                <a href="/entrar.html" class="btn btn-outline btn-sm" style="border-color: #0288d1; color: #0288d1;">
                    <i class="fas fa-sign-in-alt icon-sm"></i> Fazer Login
                </a>
                <button onclick="showQuickAccess()" class="btn btn-primary btn-sm" style="background: #0288d1; border-color: #0288d1;">
                    <i class="fas fa-rocket icon-sm"></i> Acesso R?pido
                </button>
            </div>
        </div>

        <!-- Back Link -->
        <div class="back-link">
            <a href="/entrar.html">
                <i class="fas fa-arrow-left"></i>
                Voltar para o Login
            </a>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="text-align: center; color: white;">
            <div style="width: 50px; height: 50px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; margin: 0 auto var(--space-4);"></div>
            <p>Criando conta de administrador...</p>
        </div>
    </div>

    <script>
        // Valid access tokens (em um sistema real, isso seria validado no backend)
        const VALID_TOKENS = [
            'TEMDETUDO_ADMIN_2025',
            'MASTER_ACCESS_TOKEN_2025',
            'TDP_ADMIN_CREATE_2025'
        ];

        // Format CNPJ input
        document.getElementById('companyCnpj').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Format phone input
        document.getElementById('adminPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Copy token function
        function copyToken(token) {
            navigator.clipboard.writeText(token).then(function() {
                // Fill the token field automatically
                document.getElementById('accessToken').value = token;
                
                // Show success feedback
                const element = event.target;
                const originalText = element.innerHTML;
                element.innerHTML = '? Token copiado e preenchido!';
                element.style.color = 'var(--success-green)';
                
                setTimeout(() => {
                    element.innerHTML = originalText;
                    element.style.color = 'var(--primary-600)';
                }, 2000);
            }).catch(function() {
                // Fallback: just fill the field
                document.getElementById('accessToken').value = token;
                alert('Token preenchido no campo!');
            });
        }

        // Form submission
        document.getElementById('adminRegisterForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form data
            const token = document.getElementById('accessToken').value;
            const name = document.getElementById('adminName').value;
            const email = document.getElementById('adminEmail').value;
            const phone = document.getElementById('adminPhone').value;
            const password = document.getElementById('adminPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const companyName = document.getElementById('companyName').value;
            const companyCnpj = document.getElementById('companyCnpj').value;

            // Validations
            if (!VALID_TOKENS.includes(token)) {
                alert('Token de acesso inv?lido. Entre em contato com o desenvolvedor para obter um token v?lido.');
                return;
            }

            if (password !== confirmPassword) {
                alert('As senhas n?o coincidem. Verifique e tente novamente.');
                return;
            }

            if (password.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres.');
                return;
            }

            // Check if admin already exists
            const existingAdmins = JSON.parse(localStorage.getItem('systemAdmins') || '[]');
            if (existingAdmins.find(admin => admin.email === email)) {
                alert('J? existe um administrador cadastrado com este email.');
                return;
            }

            // Show loading
            document.getElementById('loadingOverlay').style.display = 'flex';

            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Create admin user
                const adminUser = {
                    id: Date.now(),
                    nome: name,
                    email: email,
                    telefone: phone,
                    tipo: 'admin',
                    nivel: 'Master',
                    empresa: companyName || 'Sistema Tem de Ponto',
                    cnpj: companyCnpj || null,
                    permissoes: [
                        'gerenciar_empresas',
                        'relatorios_financeiros',
                        'configuracoes_sistema',
                        'criar_administradores'
                    ],
                    criadoEm: new Date().toISOString(),
                    status: 'ativo'
                };

                // Save to localStorage (em um sistema real seria salvo no banco de dados)
                existingAdmins.push(adminUser);
                localStorage.setItem('systemAdmins', JSON.stringify(existingAdmins));

                // Hide loading
                document.getElementById('loadingOverlay').style.display = 'none';

                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('adminRegisterForm').style.display = 'none';

                // Redirect after 3 seconds
                setTimeout(() => {
                    window.location.href = '/entrar.html';
                }, 3000);

            } catch (error) {
                document.getElementById('loadingOverlay').style.display = 'none';
                alert('Erro ao criar conta de administrador. Tente novamente.');
            }
        });

        // Show tokens for testing (remove in production)
        console.log('? SISTEMA DE ADMINISTRADORES - TEM DE PONTO');
        console.log('-------------------------------------------');
        console.log('?? TOKENS DE ACESSO V?LIDOS:');
        console.log('   ? TEMDETUDO_ADMIN_2025');
        console.log('   ? MASTER_ACCESS_TOKEN_2025');
        console.log('   ? TDP_ADMIN_CREATE_2025');
        console.log('');
        console.log('?? COMO USAR:');
        console.log('   1. Preencha o formul?rio');
        console.log('   2. Use um dos tokens acima');
        console.log('   3. Crie uma senha segura');
        console.log('   4. Ap?s criar, fa?a login normalmente');
        console.log('');
        console.log('? ADMIN DE TESTE J? DISPON?VEL:');
        console.log('   Email: admin@temdeponto.com');
        console.log('   Senha: adm@123');
        console.log('-------------------------------------------');

        // Quick access function
        function showQuickAccess() {
            alert(`?? ACESSO R?PIDO AO SISTEMA ADMIN

Para testar rapidamente:

1?? ADMIN DE TESTE (Mais R?pido):
   ? Email: admin@temdeponto.com
   ? Senha: adm@123
   ? Acesso: Direto ao painel

2?? CRIAR NOVO ADMIN:
   ? Fa?a login como admin de teste
   ? V? em "A??es R?pidas"  
   ? Clique "Criar Administrador"
   ? Preencha os dados normalmente

? Sistema 100% seguro agora!`);
        }
    </script><script src="/js/global.js"></script>
</body>
</html>
