<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste QR Code - Sistema de Fidelidade</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/modern-theme.css">
    
    <style>
        body {
            background: var(--gray-50);
            font-family: 'Inter', sans-serif;
            padding: 2rem;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius-2xl);
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 3rem;
            padding: 2rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
        }
        
        .test-section h3 {
            color: var(--primary-purple);
            margin-bottom: 1.5rem;
        }
        
        .qr-display {
            text-align: center;
            padding: 2rem;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin: 1rem 0;
        }
        
        .qr-code {
            font-size: 8rem;
            color: var(--primary-purple);
            margin: 1rem 0;
        }
        
        .test-button {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--primary-purple);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .test-button:hover {
            background: var(--primary-blue);
        }
        
        .test-button.success {
            background: var(--success-green);
        }
        
        .test-button.warning {
            background: var(--accent-orange);
        }
        
        .test-log {
            background: var(--gray-900);
            color: var(--gray-100);
            padding: 1rem;
            border-radius: var(--radius-lg);
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .business-model {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .plan-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
        }
        
        .plan-card.popular {
            border-color: var(--accent-orange);
            background: var(--orange-50);
        }
        
        .plan-price {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-purple);
            margin: 0.5rem 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-card {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem;
            border-radius: var(--radius-lg);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header style="text-align: center; margin-bottom: 3rem;">
            <h1 style="color: var(--primary-purple); margin-bottom: 0.5rem;">
                üöÄ Sistema QR Code - Teste Completo
            </h1>
            <p style="color: var(--gray-600);">
                Teste do novo sistema de fidelidade baseado em QR Codes din√¢micos
            </p>
        </header>

        <!-- Modelo de Neg√≥cio -->
        <div class="test-section">
            <h3><i class="fas fa-crown"></i> Modelo de Neg√≥cio SaaS</h3>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">R$ 49,90</div>
                    <div>Plano B√°sico</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">R$ 149,90</div>
                    <div>Plano Premium</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">R$ 299,90</div>
                    <div>Plano Enterprise</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">R$ 599,90</div>
                    <div>Plano Franquia</div>
                </div>
            </div>
            
            <div style="background: var(--success-50); border-radius: var(--radius-lg); padding: 1.5rem; margin-top: 1rem;">
                <h4 style="color: var(--success-green); margin-bottom: 1rem;">‚úÖ Principais Benef√≠cios:</h4>
                <ul style="color: var(--success-700); margin: 0; padding-left: 1.5rem;">
                    <li>QR Codes din√¢micos com ofertas em tempo real</li>
                    <li>Sistema de pontos multiplificador por plano</li>
                    <li>Geolocaliza√ß√£o para valida√ß√£o de check-ins</li>
                    <li>Dashboard executivo com m√©tricas avan√ßadas</li>
                    <li>API para integra√ß√µes com sistemas existentes</li>
                </ul>
            </div>
        </div>

        <!-- QR Code Simulator -->
        <div class="test-section">
            <h3><i class="fas fa-qrcode"></i> Simulador de QR Code</h3>
            
            <div class="qr-display">
                <div class="qr-code">
                    <i class="fas fa-qrcode"></i>
                </div>
                <h4>QR Code Simulado</h4>
                <p style="color: var(--gray-600); margin: 0;">C√≥digo: <code id="current-qr-code">RESTO_PREMIUM_001</code></p>
            </div>
            
            <div style="text-align: center;">
                <button class="test-button" onclick="generateQRCode()">
                    <i class="fas fa-refresh"></i> Gerar Novo QR
                </button>
                <button class="test-button success" onclick="simulateScan()">
                    <i class="fas fa-camera"></i> Simular Escaneamento
                </button>
                <button class="test-button warning" onclick="testOffers()">
                    <i class="fas fa-gift"></i> Testar Ofertas
                </button>
            </div>
        </div>

        <!-- API Test -->
        <div class="test-section">
            <h3><i class="fas fa-code"></i> Teste de APIs</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <button class="test-button" onclick="testQRScan()">
                    <i class="fas fa-search"></i> Testar /qrcode/scan
                </button>
                <button class="test-button" onclick="testQRCheckin()">
                    <i class="fas fa-check-circle"></i> Testar /qrcode/checkin
                </button>
                <button class="test-button" onclick="testQRGenerate()">
                    <i class="fas fa-plus-circle"></i> Testar /qrcode/generate
                </button>
                <button class="test-button" onclick="testQRStats()">
                    <i class="fas fa-chart-bar"></i> Testar /qrcode/stats
                </button>
            </div>
            
            <div class="test-log" id="api-log">
                <div style="color: var(--success-green);">üü¢ Sistema QR Code iniciado...</div>
                <div style="color: var(--blue-400);">‚ÑπÔ∏è  Clique nos bot√µes acima para testar as APIs</div>
            </div>
        </div>

        <!-- Business Scenarios -->
        <div class="test-section">
            <h3><i class="fas fa-store"></i> Cen√°rios de Neg√≥cio</h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                <div class="plan-card">
                    <h4>üçî Restaurante</h4>
                    <div class="plan-price">2x</div>
                    <p>Multiplicador de pontos</p>
                    <button class="test-button" onclick="testRestaurant()">Simular</button>
                </div>
                
                <div class="plan-card popular">
                    <h4>üõçÔ∏è Loja Premium</h4>
                    <div class="plan-price">1.5x</div>
                    <p>+ Ofertas din√¢micas</p>
                    <button class="test-button" onclick="testPremiumStore()">Simular</button>
                </div>
                
                <div class="plan-card">
                    <h4>üè¢ Rede/Franquia</h4>
                    <div class="plan-price">2x</div>
                    <p>Pontos compartilhados</p>
                    <button class="test-button" onclick="testFranchise()">Simular</button>
                </div>
            </div>
        </div>

        <!-- QR Code Performance -->
        <div class="test-section">
            <h3><i class="fas fa-chart-line"></i> Performance do Sistema</h3>
            
            <div id="performance-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                <div style="text-align: center; padding: 1rem; background: var(--gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--success-green);" id="scan-count">0</div>
                    <div style="font-size: 0.875rem; color: var(--gray-600);">Scans Realizados</div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-purple);" id="checkins-count">0</div>
                    <div style="font-size: 0.875rem; color: var(--gray-600);">Check-ins</div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-orange);" id="points-generated">0</div>
                    <div style="font-size: 0.875rem; color: var(--gray-600);">Pontos Gerados</div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--gray-50); border-radius: var(--radius-lg);">
                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--blue-500);" id="offers-activated">0</div>
                    <div style="font-size: 0.875rem; color: var(--gray-600);">Ofertas Ativadas</div>
                </div>
            </div>
            
            <div style="margin-top: 1rem; text-align: center;">
                <button class="test-button" onclick="resetStats()">
                    <i class="fas fa-refresh"></i> Resetar Estat√≠sticas
                </button>
                <button class="test-button success" onclick="runFullTest()">
                    <i class="fas fa-play"></i> Teste Completo
                </button>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais de teste
        let scanCount = 0;
        let checkinCount = 0;
        let pointsGenerated = 0;
        let offersActivated = 0;
        let currentQRCode = 'RESTO_PREMIUM_001';

        // Fun√ß√£o para log
        function addLog(message, type = 'info') {
            const log = document.getElementById('api-log');
            const colors = {
                'info': 'var(--blue-400)',
                'success': 'var(--success-green)',
                'error': 'var(--error-red)',
                'warning': 'var(--accent-orange)'
            };
            
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `<div style="color: ${colors[type]};">[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // Gerar novo QR Code
        function generateQRCode() {
            const prefixes = ['RESTO', 'LOJA', 'FARM', 'CAFE', 'SHOP'];
            const types = ['BASIC', 'PREMIUM', 'ENTERPRISE'];
            const numbers = String(Math.floor(Math.random() * 999) + 1).padStart(3, '0');
            
            currentQRCode = `${prefixes[Math.floor(Math.random() * prefixes.length)]}_${types[Math.floor(Math.random() * types.length)]}_${numbers}`;
            
            document.getElementById('current-qr-code').textContent = currentQRCode;
            addLog(`üîÑ Novo QR Code gerado: ${currentQRCode}`, 'info');
        }

        // Simular escaneamento
        function simulateScan() {
            scanCount++;
            updateStats();
            
            addLog(`üì± QR Code escaneado: ${currentQRCode}`, 'success');
            
            // Simular resposta da API
            setTimeout(() => {
                const mockResponse = {
                    success: true,
                    data: {
                        empresa: {
                            nome: 'Restaurante Premium',
                            endereco: 'Rua das Flores, 123'
                        },
                        pontos_base: Math.floor(Math.random() * 50) + 10,
                        multiplicador: Math.random() > 0.5 ? 1.5 : 2,
                        ofertas: Math.random() > 0.7 ? [
                            {
                                titulo: 'Desconto 10%',
                                descricao: 'Na pr√≥xima compra',
                                bonus_pontos: 20
                            }
                        ] : []
                    }
                };
                
                addLog(`‚úÖ Estabelecimento encontrado: ${mockResponse.data.empresa.nome}`, 'success');
                addLog(`üéØ Pontos base: ${mockResponse.data.pontos_base} | Multiplicador: ${mockResponse.data.multiplicador}x`, 'info');
                
                if (mockResponse.data.ofertas.length > 0) {
                    offersActivated++;
                    updateStats();
                    addLog(`üéÅ Oferta ativa: ${mockResponse.data.ofertas[0].titulo}`, 'warning');
                }
            }, 1000);
        }

        // Testar ofertas
        function testOffers() {
            const offers = [
                { titulo: 'Happy Hour', descricao: '2x pontos at√© 18h', bonus_pontos: 0 },
                { titulo: 'Desconto VIP', descricao: '15% off + pontos extras', bonus_pontos: 30 },
                { titulo: 'Combo Especial', descricao: 'Compre 2, leve 3', bonus_pontos: 50 }
            ];
            
            const randomOffer = offers[Math.floor(Math.random() * offers.length)];
            offersActivated++;
            updateStats();
            
            addLog(`üéÅ Testando oferta: ${randomOffer.titulo}`, 'warning');
            addLog(`üìã ${randomOffer.descricao}`, 'info');
            
            if (randomOffer.bonus_pontos > 0) {
                pointsGenerated += randomOffer.bonus_pontos;
                updateStats();
                addLog(`üí∞ B√¥nus: +${randomOffer.bonus_pontos} pontos`, 'success');
            }
        }

        // Testes de API
        async function testQRScan() {
            addLog(`üîÑ Testando API /qrcode/scan...`, 'info');
            
            try {
                // Simular requisi√ß√£o
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                scanCount++;
                updateStats();
                
                addLog(`‚úÖ API /qrcode/scan: OK`, 'success');
                addLog(`üìä Response: { success: true, empresa: "Teste", pontos: 25 }`, 'info');
                
            } catch (error) {
                addLog(`‚ùå Erro na API /qrcode/scan: ${error.message}`, 'error');
            }
        }

        async function testQRCheckin() {
            addLog(`üîÑ Testando API /qrcode/checkin...`, 'info');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                checkinCount++;
                const points = Math.floor(Math.random() * 100) + 20;
                pointsGenerated += points;
                updateStats();
                
                addLog(`‚úÖ API /qrcode/checkin: OK`, 'success');
                addLog(`üí∞ Check-in processado: +${points} pontos`, 'success');
                
            } catch (error) {
                addLog(`‚ùå Erro na API /qrcode/checkin: ${error.message}`, 'error');
            }
        }

        async function testQRGenerate() {
            addLog(`üîÑ Testando API /qrcode/generate...`, 'info');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                generateQRCode();
                addLog(`‚úÖ API /qrcode/generate: OK`, 'success');
                addLog(`üÜï Novo QR Code criado para estabelecimento`, 'info');
                
            } catch (error) {
                addLog(`‚ùå Erro na API /qrcode/generate: ${error.message}`, 'error');
            }
        }

        async function testQRStats() {
            addLog(`üîÑ Testando API /qrcode/stats...`, 'info');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 800));
                
                addLog(`‚úÖ API /qrcode/stats: OK`, 'success');
                addLog(`üìà Estat√≠sticas: Scans: ${scanCount}, Check-ins: ${checkinCount}, Pontos: ${pointsGenerated}`, 'info');
                
            } catch (error) {
                addLog(`‚ùå Erro na API /qrcode/stats: ${error.message}`, 'error');
            }
        }

        // Cen√°rios de neg√≥cio
        function testRestaurant() {
            addLog(`üçî Simulando: Restaurante com multiplicador 2x`, 'warning');
            simulateScan();
            
            setTimeout(() => {
                const basePoints = 35;
                const finalPoints = basePoints * 2;
                pointsGenerated += finalPoints - basePoints;
                updateStats();
                addLog(`üéØ ${basePoints} pontos base ‚Üí ${finalPoints} pontos (2x multiplicador)`, 'success');
            }, 2000);
        }

        function testPremiumStore() {
            addLog(`üõçÔ∏è Simulando: Loja Premium com ofertas din√¢micas`, 'warning');
            simulateScan();
            testOffers();
            
            setTimeout(() => {
                const basePoints = 45;
                const finalPoints = Math.floor(basePoints * 1.5);
                pointsGenerated += finalPoints - basePoints;
                updateStats();
                addLog(`üíé ${basePoints} pontos base ‚Üí ${finalPoints} pontos (1.5x + ofertas)`, 'success');
            }, 2500);
        }

        function testFranchise() {
            addLog(`üè¢ Simulando: Rede com pontos compartilhados`, 'warning');
            
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    generateQRCode();
                    simulateScan();
                    
                    if (i === 2) {
                        setTimeout(() => {
                            const totalPoints = 180;
                            pointsGenerated += totalPoints;
                            updateStats();
                            addLog(`üîó Pontos compartilhados entre 3 lojas: +${totalPoints} pontos`, 'success');
                        }, 1000);
                    }
                }, i * 1000);
            }
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            document.getElementById('scan-count').textContent = scanCount;
            document.getElementById('checkins-count').textContent = checkinCount;
            document.getElementById('points-generated').textContent = pointsGenerated;
            document.getElementById('offers-activated').textContent = offersActivated;
        }

        // Resetar estat√≠sticas
        function resetStats() {
            scanCount = 0;
            checkinCount = 0;
            pointsGenerated = 0;
            offersActivated = 0;
            updateStats();
            
            document.getElementById('api-log').innerHTML = '<div style="color: var(--success-green);">üîÑ Estat√≠sticas resetadas</div>';
            addLog(`‚ÑπÔ∏è  Sistema pronto para novos testes`, 'info');
        }

        // Teste completo
        async function runFullTest() {
            addLog(`üöÄ Iniciando teste completo do sistema...`, 'warning');
            
            const tests = [
                { name: 'QR Scan', func: testQRScan },
                { name: 'QR Generate', func: testQRGenerate },
                { name: 'Simulate Scan', func: simulateScan },
                { name: 'Test Offers', func: testOffers },
                { name: 'QR Checkin', func: testQRCheckin },
                { name: 'Restaurant Scenario', func: testRestaurant },
                { name: 'QR Stats', func: testQRStats }
            ];
            
            for (let i = 0; i < tests.length; i++) {
                addLog(`üìù Executando: ${tests[i].name}...`, 'info');
                await tests[i].func();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            addLog(`‚úÖ Teste completo finalizado!`, 'success');
            addLog(`üìä Resumo: ${scanCount} scans, ${checkinCount} check-ins, ${pointsGenerated} pontos`, 'success');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            addLog(`üü¢ Sistema QR Code Test iniciado com sucesso!`, 'success');
            addLog(`üéØ Modelo SaaS: 4 planos (R$49,90 - R$599,90)`, 'info');
            addLog(`‚ö° QR Codes din√¢micos com geolocaliza√ß√£o`, 'info');
            updateStats();
        });
    </script>
</body>
</html>