<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <title>Início - Tem de Tudo</title>
    
    <link rel="manifest" href="/manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="/js/config.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            padding-bottom: 90px;
            color: #fff;
        }
        
        /* Header */
        .header {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            backdrop-filter: blur(20px);
            padding: 16px 20px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 12px 16px;
            }
            
            .header-top {
                margin-bottom: 16px !important;
            }
            
            .logo {
                width: 44px !important;
                height: 44px !important;
            }
            
            .user-info h2 {
                font-size: 15px !important;
            }
            
            .user-info p {
                font-size: 12px !important;
            }
            
            .points-card {
                padding: 20px !important;
            }
            
            .points-value {
                font-size: 36px !important;
            }
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        
        .logo {
            width: 52px;
            height: 52px;
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .user-info h2 {
            font-weight: 700;
            font-size: 17px;
            color: #fff;
            margin-bottom: 4px;
        }
        
        .user-info p {
            font-size: 13px;
            color: #b0b0b0;
        }
        
        .settings-btn {
            width: 48px;
            height: 48px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            color: #667eea;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .settings-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: rotate(90deg);
        }
        
        /* Stats Card */
        .points-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }
        
        .points-label {
            font-size: 13px;
            opacity: 0.95;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .points-value {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 6px;
            letter-spacing: -1px;
        }
        
        .points-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* QR Code Buttons */
        .qr-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            padding: 24px 20px;
        }
        
        .qr-btn {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 2px solid rgba(102, 126, 234, 0.2);
            color: white;
            padding: 24px 16px;
            border-radius: 18px;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s;
            text-align: center;
        }
        
        .qr-btn:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.3);
        }
        
        .qr-btn i {
            font-size: 32px;
            color: #667eea;
        }
        
        /* Section Title */
        .section {
            padding: 0 20px 24px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 16px;
            color: #fff;
        }
        
        /* Mini Stats */
        .mini-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .mini-stat {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            padding: 18px 12px;
            border-radius: 14px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .mini-stat-value {
            font-size: 24px;
            font-weight: 900;
            color: #667eea;
            margin-bottom: 4px;
        }
        
        .mini-stat-label {
            font-size: 11px;
            color: #b0b0b0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Estabelecimentos */
        .estabelecimentos-grid {
            display: grid;
            gap: 16px;
        }
        
        .estabelecimento-card {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            gap: 16px;
            text-decoration: none;
            color: white;
            transition: all 0.3s;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .estabelecimento-card:hover {
            transform: translateX(4px);
            border-color: #667eea;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
        }
        
        .estabelecimento-icon {
            width: 64px;
            height: 64px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
        }
        
        .estabelecimento-info {
            flex: 1;
        }
        
        .estabelecimento-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .estabelecimento-categoria {
            font-size: 13px;
            color: #b0b0b0;
            margin-bottom: 8px;
        }
        
        .estabelecimento-pontos {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
        }
        
        .estabelecimento-pontos i {
            margin-right: 4px;
        }
        
        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border-top: 1px solid rgba(102, 126, 234, 0.2);
            padding: 8px 4px;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: #b0b0b0;
            font-size: 10px;
            font-weight: 600;
            transition: all 0.3s;
            padding: 10px 8px;
            border-radius: 12px;
            min-height: 64px;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        .nav-item i {
            font-size: 24px;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .nav-item.active i {
            transform: scale(1.2);
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #b0b0b0;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        .empty-state p {
            font-size: 14px;
        }
        
        @media (max-width: 480px) {
            .qr-buttons {
                grid-template-columns: 1fr;
            }
            
            .mini-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="/js/config.js"></script>
    <script src="/js/auth-manager.js" defer></script>
    <script src="/js/api-client.js" defer></script>
    <script src="/js/validators.js" defer></script>
    <script src="/js/ui-helpers.js" defer></script>
    <script src="/js/auth-guard.js" data-require-auth="cliente"></script>
        <link rel="stylesheet" href="/css/global-unified.css">
    <link rel="stylesheet" href="/css/theme-escuro.css">`n</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-top">
            <div class="header-left">
                <div class="logo">
                    <img src="img/logo.png" alt="Tem de Tudo">
                </div>
                <div class="user-info">
                    <h2 id="userName">Olá, Cliente!</h2>
                    <p>Bem-vindo de volta ??</p>
                </div>
            </div>
            <button class="settings-btn" onclick="location.href='app-perfil.html'">
                <i class="fas fa-cog"></i>
            </button>
        </div>
        
        <!-- Points Card -->
        <div class="points-card">
            <div class="points-label">Seus Pontos</div>
            <div class="points-value" id="userPoints">1.247</div>
            <div class="points-subtitle">Continue acumulando para resgatar!</div>
        </div>
    </div>
    
    <!-- QR Code Buttons -->
    <div class="qr-buttons">
        <a href="app-meu-qrcode.html" class="qr-btn">
            <i class="fas fa-qrcode"></i>
            <span>Meu QR Code</span>
        </a>
        <a href="app-scanner.html" class="qr-btn">
            <i class="fas fa-camera"></i>
            <span>Escanear QR</span>
        </a>
    </div>
    
    <!-- Mini Stats -->
    <div class="section">
        <div class="mini-stats">
            <div class="mini-stat">
                <div class="mini-stat-value" id="totalVisits">34</div>
                <div class="mini-stat-label">Visitas</div>
            </div>
            <div class="mini-stat">
                <div class="mini-stat-value" id="totalRewards">12</div>
                <div class="mini-stat-label">Resgates</div>
            </div>
            <div class="mini-stat">
                <div class="mini-stat-value" id="totalSaved">R$ 487</div>
                <div class="mini-stat-label">Economizou</div>
            </div>
        </div>
    </div>
    
    <!-- Estabelecimentos Frequentes -->
    <div class="section">
        <h3 class="section-title">Seus Estabelecimentos</h3>
        <div class="estabelecimentos-grid" id="estabelecimentosGrid">
            <!-- Será preenchido via JavaScript -->
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="app-inicio.html" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Início</span>
        </a>
        <a href="app-buscar.html" class="nav-item">
            <i class="fas fa-search"></i>
            <span>Buscar</span>
        </a>
        <a href="app-promocoes.html" class="nav-item">
            <i class="fas fa-gift"></i>
            <span>Promoções</span>
        </a>
        <a href="app-notificacoes.html" class="nav-item">
            <i class="fas fa-bell"></i>
            <span>Avisos</span>
        </a>
        <a href="app-perfil.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Perfil</span>
        </a>
    </nav>
    
    <script>
        // Carregar dados do usuário
        async function loadUserData() {
            const token = localStorage.getItem('tem_de_tudo_token');
            const user = JSON.parse(localStorage.getItem('tem_de_tudo_user') || '{}');
            
            if (!token) {
                window.location.href = '/entrar.html';
                return;
            }
            
            // Atualizar nome do usuário
            if (user.name) {
                document.getElementById('userName').textContent = `Olá, ${user.name.split(' ')[0]}!`;
            }
            
            try {
                const baseURL = API_CONFIG.getBaseURL();
                
                // Buscar pontos do usuário
                const pointsResponse = await fetch(`${baseURL}/api/cliente/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });
                
                if (pointsResponse.ok) {
                    const pointsData = await pointsResponse.json();
                    document.getElementById('userPoints').textContent = pointsData.total_points.toLocaleString('pt-BR');
                }
                
                // Buscar estabelecimentos frequentes
                const estabResponse = await fetch(`${baseURL}/api/cliente/empresas`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });
                
                if (estabResponse.ok) {
                    const result = await estabResponse.json();
                    const estabelecimentos = result.data || result.empresas || result;
                    console.log('? Empresas carregadas:', estabelecimentos.length);
                    renderEstabelecimentos(estabelecimentos);
                } else {
                    console.error('? Erro ao buscar empresas:', estabResponse.status);
                    renderEmptyState();
                }
                
                // Buscar estatísticas
                const statsResponse = await fetch(`${baseURL}/api/cliente/historico-pontos`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });
                
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    document.getElementById('totalVisits').textContent = stats.total_visits || '0';
                    document.getElementById('totalRewards').textContent = stats.total_rewards || '0';
                    document.getElementById('totalSaved').textContent = `R$ ${stats.total_saved || '0'}`;
                }
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                renderEmptyState();
            }
        }
        
        function renderEstabelecimentos(estabelecimentos) {
            const grid = document.getElementById('estabelecimentosGrid');
            
            if (!estabelecimentos || estabelecimentos.length === 0) {
                renderEmptyState();
                return;
            }
            
            const icons = {
                'academia': '???',
                'cafeteria': '?',
                'pet_shop': '??',
                'salao': '??',
                'mercado': '??',
                'farmacia': '??',
                'padaria': '??',
                'restaurante': '??',
                'default': '??'
            };
            const colors = [
                'linear-gradient(135deg, #667eea, #764ba2)',
                'linear-gradient(135deg, #e74c3c, #c0392b)',
                'linear-gradient(135deg, #9b59b6, #8e44ad)',
                'linear-gradient(135deg, #16a085, #0e6655)',
                'linear-gradient(135deg, #f39c12, #d68910)',
                'linear-gradient(135deg, #34495e, #2c3e50)'
            ];
            
            grid.innerHTML = estabelecimentos.map((estab, index) => `
                <a href="app-estabelecimento.html?id=${estab.id}" class="estabelecimento-card">
                    <div class="estabelecimento-icon" style="background: ${colors[index % colors.length]}">
                        ${estab.logo ? `<img src="${estab.logo}" alt="${estab.nome}" style="width:100%;height:100%;object-fit:cover;">` : icons[estab.ramo] || icons.default}
                    </div>
                    <div class="estabelecimento-info">
                        <div class="estabelecimento-name">${estab.nome}</div>
                        <div class="estabelecimento-categoria">${estab.ramo || 'Estabelecimento'}</div>
                        <div class="estabelecimento-pontos">
                            <i class="fas fa-coins"></i>
                            ${estab.meus_pontos || 0} pontos acumulados
                        </div>
                    </div>
                </a>
            `).join('');
        }
        
        function renderEmptyState() {
            const grid = document.getElementById('estabelecimentosGrid');
            grid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-store-slash"></i>
                    <p>Você ainda não visitou nenhum estabelecimento</p>
                </div>
            `;
        }
        
        // Inicializar ao carregar página
        document.addEventListener('DOMContentLoaded', loadUserData);
        
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('Service Worker registrado'))
                .catch(err => console.log('Erro ao registrar SW:', err));
        }
    </script>
</body>
</html>


