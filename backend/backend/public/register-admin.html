<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Administrador - Tem de Ponto</title>
    <meta name="description" content="Página de registro para administradores do sistema Tem de Ponto">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Modern Theme CSS -->
    <link rel="stylesheet" href="/css/modern-theme.css">
    
    <style>
        body {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-800) 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        .register-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            width: 100%;
            max-width: 500px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .logo-section {
            text-align: center;
            margin-bottom: var(--space-8);
        }

        .logo {
            width: 80px;
            height: 80px;
            background: var(--primary-600);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-4);
            color: white;
            font-size: 2rem;
        }

        .warning-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            text-align: center;
        }

        .warning-box i {
            color: #d97706;
            font-size: 1.5rem;
            margin-bottom: var(--space-2);
        }

        .warning-box h4 {
            color: #92400e;
            margin-bottom: var(--space-2);
        }

        .warning-box p {
            color: #a16207;
            font-size: 0.875rem;
            margin: 0;
        }

        .form-section {
            margin-bottom: var(--space-6);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            color: var(--gray-700);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .token-info {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-3);
            margin-bottom: var(--space-4);
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .success-message {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border: 1px solid #10b981;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            text-align: center;
            display: none;
        }

        .success-message i {
            color: #059669;
            font-size: 1.5rem;
            margin-bottom: var(--space-2);
        }

        .back-link {
            text-align: center;
            margin-top: var(--space-6);
        }

        .back-link a {
            color: var(--primary-600);
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            transition: color 0.3s ease;
        }

        .back-link a:hover {
            color: var(--primary-800);
        }

        @media (max-width: 640px) {
            .register-container {
                padding: var(--space-6);
                margin: var(--space-4);
            }
        }
    </style>
</head>
<body>
    <div class="register-container">
        <!-- Logo Section -->
        <div class="logo-section">
            <div class="logo">
                <i class="fas fa-crown"></i>
            </div>
            <h2 style="color: var(--gray-900); margin: 0;">Registro de Administrador</h2>
            <p style="color: var(--gray-600); margin: var(--space-2) 0 0;">Sistema Tem de Ponto</p>
        </div>

        <!-- Help Box -->
        <div style="background: linear-gradient(135deg, #dbeafe, #bfdbfe); border: 1px solid #3b82f6; border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-4);">
            <div style="text-align: center; margin-bottom: var(--space-3);">
                <i class="fas fa-info-circle" style="color: #1d4ed8; font-size: 1.5rem;"></i>
            </div>
            <h4 style="color: #1e40af; text-align: center; margin-bottom: var(--space-2);">💡 Como Obter o Token</h4>
            <div style="color: #1e3a8a; font-size: 0.875rem;">
                <p style="margin-bottom: var(--space-2);"><strong>Opção 1:</strong> Use um dos tokens já disponíveis abaixo (clique para copiar)</p>
                <p style="margin-bottom: var(--space-2);"><strong>Opção 2:</strong> Aperte <kbd>F12</kbd> → aba "Console" para ver os tokens</p>
                <p style="margin: 0;"><strong>Opção 3:</strong> Use o admin de teste: <code>admin@temdeponto.com</code> (qualquer senha)</p>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <i class="fas fa-check-circle"></i>
            <h4 style="color: #065f46; margin: 0 0 var(--space-2);">Administrador Criado com Sucesso!</h4>
            <p style="color: #047857; margin: 0;">Você pode agora fazer login com as credenciais criadas.</p>
        </div>

        <!-- Registration Form -->
        <form id="adminRegisterForm">
            <!-- Token Section -->
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-key"></i>
                    Token de Acesso
                </div>
                <div class="token-info">
                    <strong>Tokens de Desenvolvimento Disponíveis:</strong><br>
                    <div style="background: var(--gray-100); padding: var(--space-3); border-radius: var(--radius-md); margin-top: var(--space-2); font-family: monospace;">
                        <div style="margin-bottom: var(--space-1);"><strong>Copie um destes:</strong></div>
                        <div style="color: var(--primary-600); cursor: pointer;" onclick="copyToken('TEMDETUDO_ADMIN_2025')" title="Clique para copiar">
                            📋 TEMDETUDO_ADMIN_2025
                        </div>
                        <div style="color: var(--primary-600); cursor: pointer;" onclick="copyToken('MASTER_ACCESS_TOKEN_2025')" title="Clique para copiar">
                            📋 MASTER_ACCESS_TOKEN_2025
                        </div>
                        <div style="color: var(--primary-600); cursor: pointer;" onclick="copyToken('TDP_ADMIN_CREATE_2025')" title="Clique para copiar">
                            📋 TDP_ADMIN_CREATE_2025
                        </div>
                        <small style="color: var(--gray-500); margin-top: var(--space-2); display: block;">
                            💡 Clique em qualquer token para copiar automaticamente
                        </small>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Token de Acesso *</label>
                    <input type="password" 
                           id="accessToken" 
                           class="form-control" 
                           placeholder="Digite o token fornecido pelo desenvolvedor"
                           required>
                </div>
            </div>

            <!-- Admin Info Section -->
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-user-shield"></i>
                    Informações do Administrador
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nome Completo *</label>
                    <input type="text" 
                           id="adminName" 
                           class="form-control" 
                           placeholder="Seu nome completo"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" 
                           id="adminEmail" 
                           class="form-control" 
                           placeholder="admin@empresa.com"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Telefone *</label>
                    <input type="tel" 
                           id="adminPhone" 
                           class="form-control" 
                           placeholder="(11) 99999-9999"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Senha *</label>
                    <input type="password" 
                           id="adminPassword" 
                           class="form-control" 
                           placeholder="Crie uma senha segura"
                           minlength="6"
                           required>
                </div>

                <div class="form-group">
                    <label class="form-label">Confirmar Senha *</label>
                    <input type="password" 
                           id="confirmPassword" 
                           class="form-control" 
                           placeholder="Digite a senha novamente"
                           minlength="6"
                           required>
                </div>
            </div>

            <!-- Company Info Section -->
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-building"></i>
                    Informações da Empresa (opcional)
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nome da Empresa</label>
                    <input type="text" 
                           id="companyName" 
                           class="form-control" 
                           placeholder="Nome da sua empresa">
                </div>

                <div class="form-group">
                    <label class="form-label">CNPJ</label>
                    <input type="text" 
                           id="companyCnpj" 
                           class="form-control" 
                           placeholder="00.000.000/0000-00"
                           maxlength="18">
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-full">
                <i class="fas fa-user-plus icon-sm"></i>
                Criar Conta de Administrador
            </button>
        </form>

        <!-- Info Box -->
        <div style="background: linear-gradient(135deg, #e0f2fe, #b3e5fc); border: 1px solid #0288d1; border-radius: var(--radius-lg); padding: var(--space-4); margin-top: var(--space-6); text-align: center;">
            <i class="fas fa-info-circle" style="color: #0277bd; font-size: 1.5rem; margin-bottom: var(--space-2);"></i>
            <h4 style="color: #01579b; margin-bottom: var(--space-2);">💡 Novo Sistema Seguro</h4>
            <p style="color: #0277bd; font-size: 0.875rem; margin-bottom: var(--space-3);">
                Agora apenas administradores logados podem criar outros administradores através do painel administrativo.
            </p>
            <div style="display: flex; gap: var(--space-3); justify-content: center; flex-wrap: wrap;">
                <a href="/login.html" class="btn btn-outline btn-sm" style="border-color: #0288d1; color: #0288d1;">
                    <i class="fas fa-sign-in-alt icon-sm"></i> Fazer Login
                </a>
                <button onclick="showQuickAccess()" class="btn btn-primary btn-sm" style="background: #0288d1; border-color: #0288d1;">
                    <i class="fas fa-rocket icon-sm"></i> Acesso Rápido
                </button>
            </div>
        </div>

        <!-- Back Link -->
        <div class="back-link">
            <a href="/login.html">
                <i class="fas fa-arrow-left"></i>
                Voltar para o Login
            </a>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="text-align: center; color: white;">
            <div style="width: 50px; height: 50px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; margin: 0 auto var(--space-4);"></div>
            <p>Criando conta de administrador...</p>
        </div>
    </div>

    <script>
        // Valid access tokens (em um sistema real, isso seria validado no backend)
        const VALID_TOKENS = [
            'TEMDETUDO_ADMIN_2025',
            'MASTER_ACCESS_TOKEN_2025',
            'TDP_ADMIN_CREATE_2025'
        ];

        // Format CNPJ input
        document.getElementById('companyCnpj').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Format phone input
        document.getElementById('adminPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Copy token function
        function copyToken(token) {
            navigator.clipboard.writeText(token).then(function() {
                // Fill the token field automatically
                document.getElementById('accessToken').value = token;
                
                // Show success feedback
                const element = event.target;
                const originalText = element.innerHTML;
                element.innerHTML = '✅ Token copiado e preenchido!';
                element.style.color = 'var(--success-green)';
                
                setTimeout(() => {
                    element.innerHTML = originalText;
                    element.style.color = 'var(--primary-600)';
                }, 2000);
            }).catch(function() {
                // Fallback: just fill the field
                document.getElementById('accessToken').value = token;
                alert('Token preenchido no campo!');
            });
        }

        // Form submission
        document.getElementById('adminRegisterForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form data
            const token = document.getElementById('accessToken').value;
            const name = document.getElementById('adminName').value;
            const email = document.getElementById('adminEmail').value;
            const phone = document.getElementById('adminPhone').value;
            const password = document.getElementById('adminPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const companyName = document.getElementById('companyName').value;
            const companyCnpj = document.getElementById('companyCnpj').value;

            // Validations
            if (!VALID_TOKENS.includes(token)) {
                alert('Token de acesso inválido. Entre em contato com o desenvolvedor para obter um token válido.');
                return;
            }

            if (password !== confirmPassword) {
                alert('As senhas não coincidem. Verifique e tente novamente.');
                return;
            }

            if (password.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres.');
                return;
            }

            // Check if admin already exists
            const existingAdmins = JSON.parse(localStorage.getItem('systemAdmins') || '[]');
            if (existingAdmins.find(admin => admin.email === email)) {
                alert('Já existe um administrador cadastrado com este email.');
                return;
            }

            // Show loading
            document.getElementById('loadingOverlay').style.display = 'flex';

            try {
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Create admin user
                const adminUser = {
                    id: Date.now(),
                    nome: name,
                    email: email,
                    telefone: phone,
                    tipo: 'admin',
                    nivel: 'Master',
                    empresa: companyName || 'Sistema Tem de Ponto',
                    cnpj: companyCnpj || null,
                    permissoes: [
                        'gerenciar_empresas',
                        'relatorios_financeiros',
                        'configuracoes_sistema',
                        'criar_administradores'
                    ],
                    criadoEm: new Date().toISOString(),
                    status: 'ativo'
                };

                // Save to localStorage (em um sistema real seria salvo no banco de dados)
                existingAdmins.push(adminUser);
                localStorage.setItem('systemAdmins', JSON.stringify(existingAdmins));

                // Hide loading
                document.getElementById('loadingOverlay').style.display = 'none';

                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('adminRegisterForm').style.display = 'none';

                // Redirect after 3 seconds
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 3000);

            } catch (error) {
                document.getElementById('loadingOverlay').style.display = 'none';
                alert('Erro ao criar conta de administrador. Tente novamente.');
            }
        });

        // Show tokens for testing (remove in production)
        console.log('� SISTEMA DE ADMINISTRADORES - TEM DE PONTO');
        console.log('═══════════════════════════════════════════');
        console.log('🔑 TOKENS DE ACESSO VÁLIDOS:');
        console.log('   • TEMDETUDO_ADMIN_2025');
        console.log('   • MASTER_ACCESS_TOKEN_2025');
        console.log('   • TDP_ADMIN_CREATE_2025');
        console.log('');
        console.log('📋 COMO USAR:');
        console.log('   1. Preencha o formulário');
        console.log('   2. Use um dos tokens acima');
        console.log('   3. Crie uma senha segura');
        console.log('   4. Após criar, faça login normalmente');
        console.log('');
        console.log('✅ ADMIN DE TESTE JÁ DISPONÍVEL:');
        console.log('   Email: admin@temdeponto.com');
        console.log('   Senha: adm@123');
        console.log('═══════════════════════════════════════════');

        // Quick access function
        function showQuickAccess() {
            alert(`🚀 ACESSO RÁPIDO AO SISTEMA ADMIN

Para testar rapidamente:

1️⃣ ADMIN DE TESTE (Mais Rápido):
   • Email: admin@temdeponto.com
   • Senha: adm@123
   • Acesso: Direto ao painel

2️⃣ CRIAR NOVO ADMIN:
   • Faça login como admin de teste
   • Vá em "Ações Rápidas"  
   • Clique "Criar Administrador"
   • Preencha os dados normalmente

✅ Sistema 100% seguro agora!`);
        }
    </script>

    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</body>
</html>