<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editar Perfil - Tem de Tudo</title>
<meta name="description" content="Edite suas informa√ß√µes pessoais e prefer√™ncias">
<meta name="theme-color" content="#6F1AB6">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="global-styles.css">
<script src="global-auth.js"></script>
<script src="global-navbar.js"></script>
<style>
/* VIVO DESIGN SYSTEM - EDIT PROFILE PAGE */
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
    --vivo-purple: #6F1AB6; --vivo-purple-dark: #5A1494; --vivo-green: #10B981; --vivo-orange: #F59E0B;
    --vivo-red: #EF4444; --gray-50: #F9FAFB; --gray-100: #F3F4F6; --gray-200: #E5E7EB; --gray-300: #D1D5DB;
    --gray-400: #9CA3AF; --gray-500: #6B7280; --gray-600: #4B5563; --gray-700: #374151; --gray-800: #1F2937;
    --gray-900: #111827; --white: #FFFFFF; --border-radius: 12px; --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1); --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.15); --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
body { font-family: 'Inter', sans-serif; color: var(--gray-900); background: var(--gray-50); min-height: 100vh; }
.app-page { min-height: 100vh; display: flex; flex-direction: column; }
.app-header { background: var(--white); border-bottom: 1px solid var(--gray-200); position: sticky; top: 0; z-index: 100; }
.header-nav { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.5rem; }
.header-nav h1 { font-size: 1.25rem; font-weight: 700; color: var(--gray-900); flex: 1; text-align: center; margin: 0 1rem; }
.back-btn { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%;
    background: var(--gray-100); color: var(--gray-700); text-decoration: none; transition: var(--transition); }
.back-btn:hover { background: var(--gray-200); }
.save-btn { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%;
    background: var(--vivo-purple); color: var(--white); border: none; cursor: pointer; transition: var(--transition); }
.save-btn:hover { background: var(--vivo-purple-dark); }
.app-content { flex: 1; padding: 1rem 1.5rem 6rem; }

.section { margin-bottom: 2rem; }

.avatar-section { text-align: center; background: var(--white); border-radius: var(--border-radius); 
    padding: 2rem 1.5rem; margin-bottom: 2rem; box-shadow: var(--shadow-sm); }
.avatar-wrapper { position: relative; display: inline-block; margin-bottom: 1rem; }
.avatar { width: 100px; height: 100px; background: linear-gradient(135deg, var(--vivo-purple) 0%, var(--vivo-purple-dark) 100%);
    border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 2.5rem;
    border: 4px solid var(--white); box-shadow: var(--shadow-md); }
.avatar-edit { position: absolute; bottom: 0; right: 0; width: 36px; height: 36px; background: var(--vivo-orange);
    border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--white);
    cursor: pointer; border: 3px solid var(--white); font-size: 0.875rem; transition: var(--transition); }
.avatar-edit:hover { background: #E97A0A; transform: scale(1.1); }
.profile-hint { color: var(--gray-600); font-size: 0.875rem; }

.form-section { background: var(--white); border-radius: var(--border-radius); padding: 2rem 1.5rem; 
    box-shadow: var(--shadow-sm); }
.section-title { font-size: 1.125rem; font-weight: 700; color: var(--gray-900); margin-bottom: 1.5rem;
    display: flex; align-items: center; gap: 0.5rem; }
.section-title i { color: var(--vivo-purple); }

.form-group { margin-bottom: 1.5rem; }
.form-label { display: block; font-size: 0.875rem; font-weight: 600; color: var(--gray-700);
    margin-bottom: 0.5rem; }
.form-input { width: 100%; padding: 0.875rem 1rem; border: 2px solid var(--gray-200);
    border-radius: var(--border-radius); font-size: 1rem; transition: var(--transition);
    background: var(--white); color: var(--gray-900); }
.form-input:focus { outline: none; border-color: var(--vivo-purple); box-shadow: 0 0 0 3px rgba(111, 26, 182, 0.1); }
.form-input::placeholder { color: var(--gray-400); }

.input-group { position: relative; }
.input-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--gray-400); }
.input-group .form-input { padding-left: 2.75rem; }

.btn-save { width: 100%; background: linear-gradient(135deg, var(--vivo-purple) 0%, var(--vivo-purple-dark) 100%);
    color: var(--white); border: none; padding: 1rem 1.5rem; border-radius: var(--border-radius);
    font-size: 1rem; font-weight: 700; cursor: pointer; transition: var(--transition);
    display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: 2rem;
    box-shadow: 0 4px 15px rgba(111, 26, 182, 0.3); }
.btn-save:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(111, 26, 182, 0.4); }
.btn-save:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

.loading { width: 20px; height: 20px; border: 2px solid transparent; border-top: 2px solid var(--white);
    border-radius: 50%; animation: spin 1s linear infinite; }

.preferences-section { background: var(--white); border-radius: var(--border-radius); padding: 2rem 1.5rem;
    box-shadow: var(--shadow-sm); margin-bottom: 2rem; }

.toggle-group { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0;
    border-bottom: 1px solid var(--gray-100); }
.toggle-group:last-child { border-bottom: none; }
.toggle-label { font-weight: 600; color: var(--gray-900); }
.toggle-desc { color: var(--gray-600); font-size: 0.875rem; margin-top: 0.25rem; }
.toggle-switch { position: relative; width: 48px; height: 28px; background: var(--gray-200);
    border-radius: 14px; cursor: pointer; transition: var(--transition); }
.toggle-switch.active { background: var(--vivo-purple); }
.toggle-switch::before { content: ''; position: absolute; top: 2px; left: 2px; width: 24px; height: 24px;
    background: var(--white); border-radius: 50%; transition: var(--transition); }
.toggle-switch.active::before { transform: translateX(20px); }

.bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--white);
    border-top: 1px solid var(--gray-200); padding: 0.5rem 0; z-index: 1000; }
.nav-container { display: flex; justify-content: space-around; align-items: center; }
.nav-item { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.5rem;
    text-decoration: none; color: var(--gray-500); transition: var(--transition); font-size: 0.75rem; font-weight: 500; }
.nav-item.active { color: var(--vivo-purple); }
.nav-item:hover:not(.active) { color: var(--gray-700); }
.nav-item i { font-size: 1.25rem; margin-bottom: 2px; }

@media (max-width: 480px) {
    .app-content { padding: 1rem 1rem 6rem; }
    .avatar { width: 80px; height: 80px; font-size: 2rem; }
    .avatar-edit { width: 28px; height: 28px; }
    .form-section, .preferences-section { padding: 1.5rem 1rem; }
}

@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.app-page { animation: fadeIn 0.3s ease-out; }
.section { animation: fadeIn 0.4s ease-out; }
.section:nth-child(2) { animation-delay: 0.1s; }
.section:nth-child(3) { animation-delay: 0.2s; }
</style>
</head>
<body>
<div class="app-page">
    <!-- Header -->
    <div class="app-header">
        <div class="header-nav">
            <a href="app-perfil.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1>Editar Perfil</h1>
            <button class="save-btn" onclick="salvarPerfil()" title="Salvar altera√ß√µes">
                <i class="fas fa-check"></i>
            </button>
        </div>
    </div>

    <!-- Content -->
    <div class="app-content">
        <!-- Avatar Section -->
        <div class="section">
            <div class="avatar-section">
                <div class="avatar-wrapper">
                    <div class="avatar" id="avatarDisplay">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="avatar-edit" onclick="trocarFoto()">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <p class="profile-hint">Toque no √≠cone da c√¢mera para alterar sua foto</p>
            </div>
        </div>

        <!-- Personal Info Section -->
        <div class="section">
            <div class="form-section">
                <div class="section-title">
                    <i class="fas fa-user-edit"></i>
                    Informa√ß√µes Pessoais
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <div class="input-group">
                        <i class="input-icon fas fa-user"></i>
                        <input type="text" class="form-input" id="nome" placeholder="Digite seu nome completo">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <div class="input-group">
                        <i class="input-icon fas fa-envelope"></i>
                        <input type="email" class="form-input" id="email" placeholder="seu@email.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <div class="input-group">
                        <i class="input-icon fas fa-phone"></i>
                        <input type="tel" class="form-input" id="telefone" placeholder="(11) 99999-9999">
                    </div>
                </div>
                
                <div class="form-group admin-only-field" style="display: none;">
                    <label class="form-label">Data de Nascimento (Somente Admin)</label>
                    <div class="input-group">
                        <i class="input-icon fas fa-calendar"></i>
                        <input type="date" class="form-input" id="dataNascimento" disabled>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preferences Section -->
        <div class="section">
            <div class="preferences-section">
                <div class="section-title">
                    <i class="fas fa-cog"></i>
                    Prefer√™ncias
                </div>
                
                <div class="toggle-group">
                    <div>
                        <div class="toggle-label">Notifica√ß√µes Push</div>
                        <div class="toggle-desc">Receba alertas sobre promo√ß√µes e pontos</div>
                    </div>
                    <div class="toggle-switch active" onclick="togglePreference(this, 'notifications')"></div>
                </div>
                
                <div class="toggle-group">
                    <div>
                        <div class="toggle-label">Email Marketing</div>
                        <div class="toggle-desc">Newsletter com ofertas exclusivas</div>
                    </div>
                    <div class="toggle-switch" onclick="togglePreference(this, 'email_marketing')"></div>
                </div>
                
                <div class="toggle-group">
                    <div>
                        <div class="toggle-label">Localiza√ß√£o</div>
                        <div class="toggle-desc">Ofertas baseadas na sua localiza√ß√£o</div>
                    </div>
                    <div class="toggle-switch active" onclick="togglePreference(this, 'location')"></div>
                </div>
                
                <div class="toggle-group">
                    <div>
                        <div class="toggle-label">Tema Escuro</div>
                        <div class="toggle-desc">Interface com cores escuras</div>
                    </div>
                    <div class="toggle-switch" onclick="togglePreference(this, 'dark_mode')"></div>
                </div>
                
                <button class="btn-save" onclick="salvarPerfil()">
                    <span id="saveText">Salvar Altera√ß√µes</span>
                    <div class="loading" id="saveLoading" style="display: none;"></div>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <div class="nav-container">
        <a href="dashboard-cliente.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>In√≠cio</span>
        </a>
        <a href="app-empresas.html" class="nav-item">
            <i class="fas fa-search"></i>
            <span>Explorar</span>
        </a>
        <a href="app-pontos.html" class="nav-item">
            <i class="fas fa-star"></i>
            <span>Pontos</span>
        </a>
        <a href="app-promocoes.html" class="nav-item">
            <i class="fas fa-tags"></i>
            <span>Ofertas</span>
        </a>
        <a href="app-perfil.html" class="nav-item active">
            <i class="fas fa-bars"></i>
            <span>Menu</span>
        </a>
    </div>
</div>

<!-- Hidden file input for avatar -->
<input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarChange(event)">

<script>
let preferences = {
    notifications: true,
    email_marketing: false,
    location: true,
    dark_mode: false
};

document.addEventListener('DOMContentLoaded', function() {
    carregarDadosUsuario();
    aplicarMascaras();
});

function carregarDadosUsuario() {
    // Carregar dados do localStorage ou API
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    
    if (user.name) document.getElementById('nome').value = user.name;
    if (user.email) document.getElementById('email').value = user.email;
    if (user.telefone) document.getElementById('telefone').value = user.telefone;
    if (user.data_nascimento) document.getElementById('dataNascimento').value = user.data_nascimento;
    
    // Carregar prefer√™ncias
    const savedPrefs = JSON.parse(localStorage.getItem('preferences') || '{}');
    preferences = { ...preferences, ...savedPrefs };
    atualizarToggles();
}

function aplicarMascaras() {
    const telefoneInput = document.getElementById('telefone');
    
    telefoneInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{4})(\d)/, '$1-$2');
        value = value.replace(/(\d{4})-(\d)(\d{4})/, '$1$2-$3');
        e.target.value = value;
    });
}

function atualizarToggles() {
    Object.keys(preferences).forEach(key => {
        const toggle = document.querySelector(`[onclick*="${key}"]`);
        if (toggle && preferences[key]) {
            toggle.classList.add('active');
        }
    });
}

function trocarFoto() {
    document.getElementById('avatarInput').click();
}

function handleAvatarChange(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatarDisplay = document.getElementById('avatarDisplay');
            avatarDisplay.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            showNotification('Foto atualizada! Salve as altera√ß√µes.', 'success');
        };
        reader.readAsDataURL(file);
    }
}

function togglePreference(element, key) {
    element.classList.toggle('active');
    preferences[key] = element.classList.contains('active');
    
    // Feedback visual
    element.style.transform = 'scale(0.95)';
    setTimeout(() => {
        element.style.transform = 'scale(1)';
    }, 150);
}

async function salvarPerfil() {
    const saveText = document.getElementById('saveText');
    const saveLoading = document.getElementById('saveLoading');
    const saveBtn = document.querySelector('.btn-save');
    
    // Mostrar loading
    saveBtn.disabled = true;
    saveText.style.display = 'none';
    saveLoading.style.display = 'block';
    
    const dados = {
        nome: document.getElementById('nome').value,
        email: document.getElementById('email').value,
        telefone: document.getElementById('telefone').value,
        data_nascimento: document.getElementById('dataNascimento').value,
        preferences: preferences
    };
    
    try {
        // Simular API call
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Salvar no localStorage
        const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
        const updatedUser = { ...currentUser, ...dados };
        localStorage.setItem('user', JSON.stringify(updatedUser));
        localStorage.setItem('preferences', JSON.stringify(preferences));
        
        showNotification('Perfil atualizado com sucesso!', 'success');
        
        // Opcional: redirecionar ap√≥s salvar
        setTimeout(() => {
            window.location.href = 'app-perfil.html';
        }, 1000);
        
    } catch (error) {
        console.error('Erro ao salvar perfil:', error);
        showNotification('Erro ao salvar. Tente novamente.', 'error');
    } finally {
        // Esconder loading
        saveBtn.disabled = false;
        saveText.style.display = 'block';
        saveLoading.style.display = 'none';
    }
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
    notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; background: var(--vivo-purple); color: white;
        padding: 1rem 1.5rem; border-radius: var(--border-radius); font-weight: 600; z-index: 10000;
        box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 0.5rem; max-width: 300px;
    `;
    
    if (type === 'success') {
        notification.style.background = 'var(--vivo-green)';
        notification.querySelector('i').className = 'fas fa-check-circle';
    } else if (type === 'error') {
        notification.style.background = 'var(--vivo-red)';
        notification.querySelector('i').className = 'fas fa-exclamation-circle';
    }
    
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 4000);
}
</script>
</body>
</html>
</a>
<a href="app-empresas.html" class="nav-item">
<i class="fas fa-search"></i>
<span>Buscar</span>
</a>
<a href="app-cupons.html" class="nav-item">
<i class="fas fa-ticket-alt"></i>
<span>Cupons</span>
</a>
<a href="app-pontos.html" class="nav-item">
<i class="fas fa-coins"></i>
<span>Pontos</span>
</a>
<a href="app-perfil.html" class="nav-item active">
<i class="fas fa-user"></i>
<span>Perfil</span>
</a>
</div>
</nav>
<script>
        const API_BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:8001' : 'https://tem-de-tudo.onrender.com';
        document.addEventListener('DOMContentLoaded', async () => {
            // Verificar autenticaÔøΩÔøΩo
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            if (!token || !userStr) {
                window.location.href = 'entrar.html';
                return;
            }
            try {
                const user = JSON.parse(userStr);
                // Verificar se ÔøΩ admin para mostrar campos restritos
                const isAdmin = user.perfil === 'admin';
                const adminOnlyFields = document.querySelectorAll('.admin-only-field');
                adminOnlyFields.forEach(field => {
                    if (isAdmin) {
                        field.style.display = 'block';
                        const input = field.querySelector('input');
                        if (input) input.disabled = false;
                    } else {
                        field.style.display = 'none';
                    }
                });
                // Preencher campos com dados do usu√°rio
                document.getElementById('nome').value = user.name || user.nome || '';
                document.getElementById('email').value = user.email || '';
                document.getElementById('telefone').value = user.telefone || '';
                if (isAdmin) {
                    document.getElementById('dataNascimento').value = user.data_nascimento || '';
                }
                // Feedback visual de carregamento
                mostrarFeedback('Dados carregados!', 'success');
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                mostrarFeedback('Erro ao carregar dados', 'error');
            }
        });
        async function salvarPerfil() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            const user = JSON.parse(userStr);
            const isAdmin = user.perfil === 'admin';
            const dados = {
                name: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value
            };
            // Apenas admin pode alterar data de nascimento
            if (isAdmin) {
                dados.data_nascimento = document.getElementById('dataNascimento').value;
            }
            // Valida√ß√£o b√°sica
            if (!dados.name || !dados.email) {
                mostrarFeedback('Nome e email s√£o obrigat√≥rios!', 'error');
                return;
            }
            mostrarFeedback('Salvando altera√ß√µes...', 'info');
            try {
                // SIMULA√á√ÉO TEMPOR√ÅRIA - Funcionar√° at√© backend estar completo
                if (!token) {
                    mostrarFeedback('üîí Voc√™ precisa estar logado', 'error');
                    setTimeout(() => window.location.href = 'entrar.html', 1500);
                    return;
                }
                // Simular delay da API
                await new Promise(resolve => setTimeout(resolve, 1000));
                // Atualizar dados locais (funciona como se fosse real)
                const userAtual = JSON.parse(localStorage.getItem('user') || '{}');
                const userAtualizado = {
                    ...userAtual,
                    name: dados.name,
                    nome: dados.name,
                    email: dados.email,
                    telefone: dados.telefone,
                    data_nascimento: dados.data_nascimento
                };
                localStorage.setItem('user', JSON.stringify(userAtualizado));
                mostrarFeedback('‚úÖ Perfil atualizado com sucesso!', 'success');
                setTimeout(() => {
                    window.location.href = '/app-perfil.html';
                }, 1500);
            } catch (error) {
                console.error('Erro:', error);
                mostrarFeedback('‚ùå Erro ao salvar. Tente novamente.', 'error');
            }
        }
        function trocarFoto() {
            mostrarFeedback('üì∏ Funcionalidade de foto ser√° implementada em breve!', 'info');
        }
        function mostrarFeedback(mensagem, tipo) {
            // Criar elemento de feedback
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${tipo === 'success' ? 'linear-gradient(135deg, #00d4aa, #00c896)' : tipo === 'error' ? 'linear-gradient(135deg, #ff6b6b, #ff5252)' : 'linear-gradient(135deg, #6F1AB6, #9333EA)'};
                color: ${tipo === 'success' || tipo === 'error' ? '#fff' : '#0a0a0f'};
                padding: 12px 24px;
                border-radius: 16px;
                font-weight: 600;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
                animation: slideDown 0.3s ease;
            `;
            feedback.textContent = mensagem;
            document.body.appendChild(feedback);
            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                feedback.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => document.body.removeChild(feedback), 300);
            }, 3000);
        }
        // Adicionar estilos para animaÔøΩÔøΩes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translate(-50%, -100%); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translate(-50%, 0); opacity: 1; }
                to { transform: translate(-50%, -100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>