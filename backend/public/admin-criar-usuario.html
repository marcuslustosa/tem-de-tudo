<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Criar Usu�rio - Admin Tem de Tudo</title>
<meta name="description" content="Painel administrativo para criar novos usu�rios">
<meta name="theme-color" content="#6F1AB6">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="js/config.js"></script>
<script src="js/auth-guard.js"></script>
<link rel="stylesheet" href="css/vivo-styles.css">
</head>
<body>
<div class="admin-create-user-page">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-container">
            <h1 class="page-title">
                <i class="fas fa-user-plus"></i>
                Criar Novo Usu�rio
            </h1>
            <a href="admin-usuarios.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Voltar
            </a>
        </div>
    </div>
    <!-- Page Container -->
    <div class="page-container">
        <div class="form-card fade-in">
            <!-- Form Header -->
            <div class="form-header">
                <div class="form-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h2 class="form-title">Cadastrar Usu�rio</h2>
                <p class="form-subtitle">Preencha as informa��es para criar um novo usu�rio no sistema</p>
            </div>
            <!-- Error/Success Messages -->
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            <!-- Create User Form -->
            <form class="create-user-form" id="createUserForm" onsubmit="handleSubmit(event)">
                <!-- Basic Info -->
                <div class="form-group full-width">
                    <label class="form-label" for="nome">
                        Nome Completo <span class="required">*</span>
                    </label>
                    <input type="text" id="nome" name="nome" class="form-input" required 
                           placeholder="Digite o nome completo do usu�rio">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="email">
                            Email <span class="required">*</span>
                        </label>
                        <input type="email" id="email" name="email" class="form-input" required 
                               placeholder="usuario@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="telefone">
                            Telefone
                        </label>
                        <input type="tel" id="telefone" name="telefone" class="form-input" 
                               placeholder="(11) 99999-9999">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="cpf">
                            CPF <span class="required">*</span>
                        </label>
                        <input type="text" id="cpf" name="cpf" class="form-input" required 
                               placeholder="000.000.000-00" maxlength="14">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="dataNascimento">
                            Data de Nascimento
                        </label>
                        <input type="date" id="dataNascimento" name="dataNascimento" class="form-input">
                    </div>
                </div>
                <!-- Password -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="senha">
                            Senha <span class="required">*</span>
                        </label>
                        <div class="password-group">
                            <input type="password" id="senha" name="senha" class="form-input" required 
                                   minlength="6" placeholder="M�nimo 6 caracteres" 
                                   oninput="checkPasswordStrength()">
                            <button type="button" class="password-toggle" onclick="togglePassword('senha', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="password-strength" id="passwordStrength">
                            <div class="strength-indicator">
                                <div class="strength-fill" id="strengthFill"></div>
                            </div>
                            <span id="strengthText">Digite uma senha</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="confirmarSenha">
                            Confirmar Senha <span class="required">*</span>
                        </label>
                        <div class="password-group">
                            <input type="password" id="confirmarSenha" name="confirmarSenha" class="form-input" 
                                   required minlength="6" placeholder="Confirme a senha">
                            <button type="button" class="password-toggle" onclick="togglePassword('confirmarSenha', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Profile Selection -->
                <div class="form-group full-width">
                    <label class="form-label">
                        Perfil do Usu?rio <span class="required">*</span>
                    </label>
                    <input type="hidden" id="perfil" name="perfil" required>
                    <div class="profile-selector">
                        <div class="profile-option" onclick="selectProfile('admin', this)">
                            <div class="profile-icon">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="profile-name">Administrador</div>
                            <div class="profile-desc">Acesso total ao sistema</div>
                        </div>
                        <div class="profile-option" onclick="selectProfile('empresa', this)">
                            <div class="profile-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="profile-name">Empresa</div>
                            <div class="profile-desc">Gest?o empresarial</div>
                        </div>
                        <div class="profile-option" onclick="selectProfile('cliente', this)">
                            <div class="profile-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="profile-name">Cliente</div>
                            <div class="profile-desc">Usu?rio final</div>
                        </div>
                    </div>
                </div>
                <!-- Form Actions -->
                <div class="form-actions">
                    <a href="admin-usuarios.html" class="btn-cancel">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </a>
                    <button type="submit" class="btn-submit" id="submitBtn">
                        <span id="submitText">
                            <i class="fas fa-save"></i>
                            Criar Usu?rio
                        </span>
                        <div class="loading" id="submitLoading" style="display: none;"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Bottom Navigation -->
<div class="bottom-nav">
    <div class="nav-container">
        <a href="admin-painel.html" class="nav-item">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
        </a>
        <a href="admin-usuarios.html" class="nav-item active">
            <i class="fas fa-users"></i>
            <span>Usu?rios</span>
        </a>
        <a href="admin-empresas.html" class="nav-item">
            <i class="fas fa-building"></i>
            <span>Empresas</span>
        </a>
        <a href="admin-promocoes.html" class="nav-item">
            <i class="fas fa-tags"></i>
            <span>Promo??es</span>
        </a>
        <a href="admin-configuracoes.html" class="nav-item">
            <i class="fas fa-cogs"></i>
            <span>Config</span>
        </a>
    </div>
</div>
<script src="/js/config.js"></script>
<script>
// Toggle password visibility
function togglePassword(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('i');
    if (input.type === 'password') {
        input.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        input.type = 'password';
        icon.className = 'fas fa-eye';
    }
}
// Check password strength
function checkPasswordStrength() {
    const password = document.getElementById('senha').value;
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');
    let strength = 0;
    let text = '';
    if (password.length >= 6) strength++;
    if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
    if (password.match(/[0-9]/)) strength++;
    if (password.match(/[^A-Za-z0-9]/)) strength++;
    strengthFill.className = 'strength-fill';
    if (password.length === 0) {
        strengthFill.style.width = '0%';
        text = 'Digite uma senha';
    } else if (strength <= 1) {
        strengthFill.classList.add('strength-weak');
        text = 'Senha fraca';
    } else if (strength <= 2) {
        strengthFill.classList.add('strength-medium');
        text = 'Senha m?dia';
    } else {
        strengthFill.classList.add('strength-strong');
        text = 'Senha forte';
    }
    strengthText.textContent = text;
}
// Select user profile
function selectProfile(profile, element) {
    // Remove selection from all options
    document.querySelectorAll('.profile-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    // Add selection to clicked option
    element.classList.add('selected');
    // Set hidden input value
    document.getElementById('perfil').value = profile;
    console.log('Profile selected:', profile);
}
// Format CPF input
document.getElementById('cpf').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    e.target.value = value;
});
// Format phone input
document.getElementById('telefone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
    value = value.replace(/^(\d{2})(\d{4})(\d{4})$/, '($1) $2-$3');
    e.target.value = value;
});
// Show messages
function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    errorDiv.textContent = message;
    errorDiv.classList.add('show');
    setTimeout(() => {
        errorDiv.classList.remove('show');
    }, 5000);
}
function showSuccess(message) {
    const successDiv = document.getElementById('successMessage');
    successDiv.textContent = message;
    successDiv.classList.add('show');
    setTimeout(() => {
        successDiv.classList.remove('show');
    }, 3000);
}
// Handle form submission
async function handleSubmit(event) {
    event.preventDefault();
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitLoading = document.getElementById('submitLoading');
    // Get form data
    const senha = document.getElementById('senha').value;
    const confirmarSenha = document.getElementById('confirmarSenha').value;
    // Validate passwords
    if (senha !== confirmarSenha) {
        showError('As senhas n?o conferem!');
        return;
    }
    if (senha.length < 6) {
        showError('A senha deve ter pelo menos 6 caracteres!');
        return;
    }
    // Check if profile is selected
    const perfil = document.getElementById('perfil').value;
    if (!perfil) {
        showError('Selecione um perfil para o usu?rio!');
        return;
    }
    // Prepare form data
    const formData = {
        nome: document.getElementById('nome').value,
        email: document.getElementById('email').value,
        cpf: document.getElementById('cpf').value.replace(/\D/g, ''),
        telefone: document.getElementById('telefone').value.replace(/\D/g, ''),
        senha: senha,
        perfil: perfil,
        data_nascimento: document.getElementById('dataNascimento').value || null
    };
    // Show loading state
    submitBtn.disabled = true;
    submitText.style.display = 'none';
    submitLoading.style.display = 'block';
    try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const response = await fetch(`${API_CONFIG.getBaseURL()}/api/admin/users`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        const result = await response.json();
        if (response.ok) {
            showSuccess('Usu?rio criado com sucesso! Redirecionando...');
            setTimeout(() => {
                window.location.href = 'admin-usuarios.html';
            }, 1500);
        } else {
            throw new Error(result.message || 'Erro ao criar usu?rio');
        }
    } catch (error) {
        console.error('Erro ao criar usu?rio:', error);
        showError(error.message || 'Erro ao conectar com o servidor');
    } finally {
        // Hide loading state
        submitBtn.disabled = false;
        submitText.style.display = 'flex';
        submitLoading.style.display = 'none';
    }
}
// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    console.log('P?gina de cria??o de usu?rio carregada');
    // Check authentication
    const token = localStorage.getItem('authToken') || localStorage.getItem('token');
    const userType = localStorage.getItem('userType');
    if (!token || userType !== 'admin') {
        alert('?? Acesso negado. Redirecionando...');
        window.location.href = '/entrar.html';
        return;
    }
    // Focus first input
    document.getElementById('nome').focus();
});
</script>
</body>
</html></body>
</html>

