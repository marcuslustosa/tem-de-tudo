<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code - Tem de Tudo</title>
<meta name="description" content="Seu QR Code para acumular pontos">
<meta name="theme-color" content="#6F1AB6">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="manifest" href="/manifest.json">
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<link rel="stylesheet" href="css/vivo-styles.css">
<body class="app-page">
<!-- App Header -->
<div class="app-header">
    <button class="app-back-btn" onclick="history.back()">
        <i class="fas fa-arrow-left"></i>
    </button>
    <h1 class="app-title">Meu QR Code</h1>
    <div class="app-actions">
        <button class="app-action-btn" onclick="shareCode()">
            <i class="fas fa-share-alt"></i>
        </button>
    </div>
</div>
<!-- User Info -->
<div class="app-section">
    <div class="qr-user-info">
        <div class="qr-avatar">
            <i class="fas fa-user"></i>
        </div>
        <div class="qr-user-details">
            <h2 id="userName">João Silva</h2>
            <p>Nível: <span class="user-level" id="userLevel">Bronze</span></p>
            <p class="user-id">ID: <span id="userId">#123456</span></p>
        </div>
    </div>
</div>
<!-- QR Code Section -->
<div class="app-section">
    <div class="qr-container">
        <div class="qr-code-wrapper">
            <!-- QR Code Canvas -->
            <div class="qr-code" id="qrCodeContainer">
                <canvas id="qrCanvas"></canvas>
            </div>
            <div class="qr-refresh">
                <button class="qr-refresh-btn" onclick="refreshCode()">
                    <i class="fas fa-sync-alt"></i>
                    Atualizar código
                </button>
            </div>
        </div>
        <div class="qr-instructions">
            <h3>Como usar seu QR Code</h3>
            <div class="instruction-list">
                <div class="instruction-item">
                    <div class="instruction-number">1</div>
                    <p>Apresente este código no estabelecimento</p>
                </div>
                <div class="instruction-item">
                    <div class="instruction-number">2</div>
                    <p>Aguarde o estabelecimento escanear</p>
                </div>
                <div class="instruction-item">
                    <div class="instruction-number">3</div>
                    <p>Seus pontos serão creditados automaticamente</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Quick Actions -->
<div class="app-section">
    <h2 class="section-title">Ações Rápidas</h2>
    <div class="quick-action-grid">
        <button class="quick-action-card" onclick="increaseScreen()">
            <div class="quick-action-icon">
                <i class="fas fa-expand"></i>
            </div>
            <span>Tela Cheia</span>
        </button>
        <button class="quick-action-card" onclick="adjustBrightness()">
            <div class="quick-action-icon">
                <i class="fas fa-sun"></i>
            </div>
            <span>Brilho Máximo</span>
        </button>
        <button class="quick-action-card" onclick="saveToPhotos()">
            <div class="quick-action-icon">
                <i class="fas fa-download"></i>
            </div>
            <span>Salvar Imagem</span>
        </button>
        <button class="quick-action-card" onclick="shareCode()">
            <div class="quick-action-icon">
                <i class="fas fa-share"></i>
            </div>
            <span>Compartilhar</span>
        </button>
    </div>
</div>
<!-- Alternative Methods -->
<div class="app-section">
    <h2 class="section-title">Métodos Alternativos</h2>
    <div class="alternative-methods">
        <div class="method-card">
            <div class="method-icon">
                <i class="fas fa-id-card"></i>
            </div>
            <div class="method-info">
                <h4>Informar CPF</h4>
                <p>Você também pode informar seu CPF: <strong id="userCPF">123.456.789-00</strong></p>
            </div>
            <button class="method-copy-btn" onclick="copyCPF()">
                <i class="fas fa-copy"></i>
            </button>
        </div>
        <div class="method-card">
            <div class="method-icon">
                <i class="fas fa-phone"></i>
            </div>
            <div class="method-info">
                <h4>Informar Telefone</h4>
                <p>Ou seu número de telefone: <strong id="userPhone">(11) 99999-9999</strong></p>
            </div>
            <button class="method-copy-btn" onclick="copyPhone()">
                <i class="fas fa-copy"></i>
            </button>
        </div>
    </div>
</div>
<!-- Security Notice -->
<div class="app-section">
    <div class="security-notice">
        <div class="security-icon">
            <i class="fas fa-shield-alt"></i>
        </div>
        <div class="security-content">
            <h4>Segurança do seu código</h4>
            <p>Seu QR Code é único e seguro. Não compartilhe com desconhecidos e sempre verifique se está no estabelecimento correto antes de apresentá-lo.</p>
        </div>
    </div>
</div>
<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <a href="app-inicio.html" class="nav-item">
        <i class="fas fa-home"></i>
        <span>Início</span>
    </a>
    <a href="app-meus-pontos.html" class="nav-item">
        <i class="fas fa-coins"></i>
        <span>Pontos</span>
    </a>
    <a href="app-meu-qrcode.html" class="nav-item active">
        <i class="fas fa-qrcode"></i>
        <span>QR Code</span>
    </a>
    <a href="app-perfil.html" class="nav-item">
        <i class="fas fa-user"></i>
        <span>Perfil</span>
    </a>
</nav>
<script>
let currentUserData = {};
// Load user data
async function loadUserData() {
    try {
        // Simulate API call - replace with actual API
        currentUserData = {
            id: 'user123456',
            name: 'João Silva',
            cpf: '123.456.789-00',
            phone: '(11) 99999-9999',
            level: 'Bronze'
        };
        // Update UI
        document.getElementById('userName').textContent = currentUserData.name;
        document.getElementById('userId').textContent = `#${currentUserData.id}`;
        document.getElementById('userLevel').textContent = currentUserData.level;
        document.getElementById('userCPF').textContent = currentUserData.cpf;
        document.getElementById('userPhone').textContent = currentUserData.phone;
        // Generate QR Code
        generateQRCode();
    } catch (error) {
        console.error('Error loading user data:', error);
        showToast('Erro ao carregar dados do usuário');
    }
}
// Generate QR Code
async function generateQRCode() {
    try {
        const canvas = document.getElementById('qrCanvas');
        const qrData = {
            userId: currentUserData.id,
            timestamp: Date.now(),
            type: 'loyalty_card'
        };
        await QRCode.toCanvas(canvas, JSON.stringify(qrData), {
            width: 200,
            margin: 2,
            color: {
                dark: '#6F1AB6',
                light: '#FFFFFF'
            }
        });
    } catch (error) {
        console.error('Error generating QR code:', error);
        showToast('Erro ao gerar QR Code');
    }
}
// Refresh QR Code
function refreshCode() {
    const refreshBtn = document.querySelector('.qr-refresh-btn');
    const icon = refreshBtn.querySelector('i');
    // Add loading state
    icon.classList.add('fa-spin');
    refreshBtn.disabled = true;
    setTimeout(() => {
        icon.classList.remove('fa-spin');
        refreshBtn.disabled = false;
        showToast('Código atualizado com sucesso!');
        generateQRCode();
    }, 1500);
}
// Share QR Code
async function shareCode() {
    try {
        if (navigator.share) {
            const canvas = document.getElementById('qrCanvas');
            canvas.toBlob(async (blob) => {
                const file = new File([blob], 'qr-code-tem-de-tudo.png', { type: 'image/png' });
                await navigator.share({
                    title: 'Meu QR Code - Tem de Tudo',
                    text: 'Veja meu QR Code do programa de fidelidade Tem de Tudo',
                    files: [file]
                });
            });
        } else {
            showToast('Recurso de compartilhamento não disponível');
        }
    } catch (error) {
        console.error('Error sharing:', error);
        showToast('Erro ao compartilhar');
    }
}
// Full screen mode
function increaseScreen() {
    try {
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
            showToast('Modo tela cheia ativado');
        } else {
            showToast('Tela cheia não disponível neste navegador');
        }
    } catch (error) {
        showToast('Erro ao ativar tela cheia');
    }
}
// Adjust brightness
function adjustBrightness() {
    document.body.style.filter = 'brightness(1.3)';
    showToast('Brilho ajustado ao máximo por 10 segundos');
    // Reset after 10 seconds
    setTimeout(() => {
        document.body.style.filter = 'brightness(1)';
        showToast('Brilho restaurado ao normal');
    }, 10000);
}
// Save QR code to photos
function saveToPhotos() {
    try {
        const canvas = document.getElementById('qrCanvas');
        // Create a new canvas with more content
        const downloadCanvas = document.createElement('canvas');
        const ctx = downloadCanvas.getContext('2d');
        downloadCanvas.width = 400;
        downloadCanvas.height = 500;
        // Set white background
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, 400, 500);
        // Add header
        ctx.fillStyle = '#6F1AB6';
        ctx.font = 'bold 24px Inter';
        ctx.textAlign = 'center';
        ctx.fillText('Tem de Tudo', 200, 40);
        // Add user info
        ctx.fillStyle = '#333';
        ctx.font = '16px Inter';
        ctx.fillText(currentUserData.name, 200, 70);
        ctx.font = '14px Inter';
        ctx.fillText(`ID: #${currentUserData.id}`, 200, 90);
        // Draw QR code
        ctx.drawImage(canvas, 100, 120, 200, 200);
        // Add instructions
        ctx.fillStyle = '#666';
        ctx.font = '12px Inter';
        ctx.fillText('Apresente este código no estabelecimento', 200, 360);
        ctx.fillText('para acumular pontos', 200, 380);
        // Add timestamp
        ctx.fillStyle = '#999';
        ctx.font = '10px Inter';
        ctx.fillText(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 200, 420);
        // Download
        const link = document.createElement('a');
        link.download = 'qr-code-tem-de-tudo.png';
        link.href = downloadCanvas.toDataURL();
        link.click();
        showToast('QR Code salvo com sucesso!');
    } catch (error) {
        console.error('Error saving QR code:', error);
        showToast('Erro ao salvar QR Code');
    }
}
// Copy CPF
async function copyCPF() {
    try {
        const cpf = currentUserData.cpf.replace(/\D/g, '');
        await navigator.clipboard.writeText(cpf);
        showToast('CPF copiado para a área de transferência');
    } catch (error) {
        showToast('Erro ao copiar CPF');
    }
}
// Copy phone
async function copyPhone() {
    try {
        const phone = currentUserData.phone.replace(/\D/g, '');
        await navigator.clipboard.writeText(phone);
        showToast('Telefone copiado para a área de transferência');
    } catch (error) {
        showToast('Erro ao copiar telefone');
    }
}
// Toast notification
function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
    document.body.appendChild(toast);
    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            if (document.body.contains(toast)) {
                document.body.removeChild(toast);
            }
        }, 300);
    }, 3000);
}
// Global timer reference
let qrRefreshTimer;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadUserData();
    // Auto-refresh QR code every 5 minutes for security
    qrRefreshTimer = setInterval(() => {
        generateQRCode();
    }, 300000);
});

// Cleanup on page unload
window.addEventListener('beforeunload', function() {
    if (qrRefreshTimer) {
        clearInterval(qrRefreshTimer);
    }
});
// Handle offline/online states
window.addEventListener('online', function() {
    showToast('Conexão restaurada - QR Code atualizado');
    generateQRCode();
});
window.addEventListener('offline', function() {
    showToast('Sem conexão - QR Code pode estar desatualizado');
});
</script>
</body>
</html>

