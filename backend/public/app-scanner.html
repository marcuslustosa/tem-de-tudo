<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scanner QR Code - Tem de Tudo</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#6A0DAD">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="/css/vivo-global.css">
<body>
<div class="header">
<h1> Scanner QR Code</h1>
<p>Escaneie para ganhar pontos</p>
</div>
<div class="scanner-container">
<div class="scanner-box">
<div class="scanner-icon">
<i class="fas fa-qrcode"></i>
</div>
<div class="scanner-title">Escaneie o QR Code</div>
<div class="scanner-subtitle">Aponte a câmera para o QR Code da empresa para fazer check-in e ganhar pontos</div>
<button class="btn-scan" onclick="iniciarScanner()">
<i class="fas fa-camera"></i>
                Abrir Câmera
            </button>
<video id="video" autoplay playsinline></video>
</div>
<div class="divider">OU</div>
<div class="manual-input">
<h3>Digite o código manualmente</h3>
<div class="input-group">
<label>Código da Empresa</label>
<input type="text" id="codigoManual" placeholder="Ex: EMP12345" maxlength="20">
</div>
<button class="btn-submit" onclick="fazerCheckinManual()">
<i class="fas fa-check-circle"></i> Fazer Check-in
            </button>
</div>
<div class="info-cards">
<div class="info-card">
<div class="info-icon">
<i class="fas fa-coins"></i>
</div>
<div class="info-content">
<h4>Ganhe pontos a cada visita</h4>
<p>Acumule pontos e troque por prêmios</p>
</div>
</div>
<div class="info-card">
<div class="info-icon">
<i class="fas fa-star"></i>
</div>
<div class="info-content">
<h4>Bônus especiais</h4>
<p>Receba pontos extras em datas comemorativas</p>
</div>
</div>
<div class="info-card">
<div class="info-icon">
<i class="fas fa-shield-alt"></i>
</div>
<div class="info-content">
<h4>Seguro e confiável</h4>
<p>Seus dados estão protegidos</p>
</div>
</div>
</div>
</div>
<nav class="bottom-nav">
<a href="app-inicio.html" class="nav-item"><i class="fas fa-home"></i><span>Início</span></a>
<a href="app-empresas.html" class="nav-item"><i class="fas fa-search"></i><span>Buscar</span></a>
<a href="app-meus-pontos.html" class="nav-item active"><i class="fas fa-wallet"></i><span>Pontos</span></a>
<a href="app-promocoes.html" class="nav-item"><i class="fas fa-tags"></i><span>Promoções</span></a>
<a href="app-perfil.html" class="nav-item"><i class="fas fa-user"></i><span>Perfil</span></a>
</nav>
<script>
        const API_BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:8001' : 'https://tem-de-tudo.onrender.com';
        let stream = null;
        function iniciarScanner() {
            const video = document.getElementById('video');
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then(s => {
                        stream = s;
                        video.srcObject = stream;
                        video.style.display = 'block';
                        alert('Scanner ativado! (Em desenvolvimento - Use o código manual por enquanto)');
                    })
                    .catch(err => {
                        console.error('Erro ao acessar câmera:', err);
                        alert('Não foi possível acessar a câmera. Use o código manual.');
                    });
            } else {
                alert('Seu navegador não suporta acesso à câmera. Use o código manual.');
            }
        }
        async function fazerCheckinManual() {
            const codigo = document.getElementById('codigoManual').value.trim();
            if (!codigo) {
                alert('Digite o código da empresa');
                return;
            }
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'entrar.html';
                return;
            }
            try {
                const response = await fetch(`${API_BASE_URL}/api/check-in`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ codigo_empresa: codigo })
                });
                const data = await response.json();
                if (data.success) {
                    alert(` Check-in realizado! Você ganhou ${data.pontos || 10} pontos!`);
                    window.location.href = '/app-meus-pontos.html';
                } else {
                    alert(' ' + (data.message || 'Código inválido'));
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao fazer check-in. Tente novamente.');
            }
        }
        document.getElementById('codigoManual').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') fazerCheckinManual();
        });
    </script>
</body>
</html>