<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#6F1AB6">
<title>Meu QR Code - Tem de Tudo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="manifest" href="/manifest.json">
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script src="/js/config.js"></script>
<script src="/js/auth-manager.js" defer></script>
<script src="/js/api-client.js" defer></script>
<script src="/js/validators.js" defer></script>
<script src="/js/ui-helpers.js" defer></script>
<script src="/js/auth-guard.js" data-require-auth="cliente"></script>
<link rel="stylesheet" href="/css/global-unified.css">
<link rel="stylesheet" href="/css/theme-escuro.css">`n    <link rel="stylesheet" href="/css/vale-bonus-theme.css">
<link rel="stylesheet" href="/css/style-unificado.css?v=3">
</head>
<body>
<div class="header">
<button class="back-btn" onclick="location.href='/dashboard-cliente.html'">
<i class="fas fa-arrow-left"></i>
</button>
<div class="header-title">
<h1>Meu QR Code</h1>
<p>Apresente ao estabelecimento</p>
</div>
</div>
<div class="qr-container">
<div class="qr-card">
<div class="user-info">
<div class="user-avatar">
<i class="fas fa-user"></i>
</div>
<div class="user-name" id="userName">Carregando...</div>
<div class="user-id" id="userId">ID: #0000</div>
</div>
<div class="qr-wrapper">
<div id="qrcode"></div>
</div>
<div class="brightness-control">
<div class="brightness-label">
<span><i class="fas fa-sun"></i> Brilho da Tela</span>
<span id="brightnessValue">100%</span>
</div>
<input type="range" min="30" max="100" value="100" class="brightness-slider" id="brightnessSlider">
</div>
</div>
<div class="qr-instructions">
<h3><i class="fas fa-info-circle"></i> Como usar</h3>
<ul>
<li>Apresente este QR Code ao caixa do estabelecimento</li>
<li>Aguarde a validaàào pelo scanner</li>
<li>Seus pontos seráo creditados automaticamente</li>
<li>Mantenha o brilho da tela no màximo para melhor leitura</li>
</ul>
</div>
<div class="action-buttons">
<button class="btn btn-primary" onclick="shareQRCode()">
<i class="fas fa-share-alt"></i> Compartilhar QR Code
            </button>
<button class="btn btn-secondary" onclick="downloadQRCode()">
<i class="fas fa-download"></i> Baixar Imagem
            </button>
</div>
</div>
<nav class="bottom-nav">
<a href="/app-inicio.html" class="nav-item active">
<i class="fas fa-home"></i>
<span>Início</span>
</a>
<a href="/app-empresas.html" class="nav-item">
<i class="fas fa-store"></i>
<span>Empresas</span>
</a>
<a href="/app-promocoes.html" class="nav-item">
<i class="fas fa-tags"></i>
<span>Promoções</span>
</a>
<a href="/app-qrcode.html" class="nav-item active">
<i class="fas fa-qrcode"></i>
<span>Meu QR</span>
</a>
<a href="/app-perfil-cliente.html" class="nav-item">
<i class="fas fa-user"></i>
<span>Perfil</span>
</a>
</nav>
<script>
        const userStr = localStorage.getItem('user');
        let user = null;
        if (userStr && userStr !== 'undefined' && userStr !== 'null') {
            try {
                user = JSON.parse(userStr);
            } catch (e) {
                console.error('Erro ao parsear user:', e);
            }
        }
        
        if (!user.id) {
            window.location.href = 'entrar.html';
        } else {
            // Atualizar nome e ID do usuário
            document.getElementById('userName').textContent = user.name || 'Usuário';
            document.getElementById('userId').textContent = `ID: #${String(user.id).padStart(4, '0')}`;
            
            // Gerar QR Code
            const qrData = JSON.stringify({
                user_id: user.id,
                user_type: 'cliente',
                timestamp: Date.now()
            });
            
            QRCode.toCanvas(document.createElement('canvas'), qrData, {
                width: 280,
                margin: 2,
                color: {
                    dark: '#0a0a0f',
                    light: '#ffffff'
                }
            }, function (error, canvas) {
                if (error) {
                    console.error(error);
                    alert('Erro ao gerar QR Code');
                } else {
                    document.getElementById('qrcode').appendChild(canvas);
                }
            });
        }
        
        // Controle de brilho
        const slider = document.getElementById('brightnessSlider');
        const brightnessValue = document.getElementById('brightnessValue');
        
        slider.addEventListener('input', function() {
            const value = this.value;
            brightnessValue.textContent = value + '%';
            document.body.style.filter = `brightness(${value}%)`;
        });
        
        function shareQRCode() {
            if (navigator.share) {
                navigator.share({
                    title: 'Meu QR Code - Tem de Tudo',
                    text: 'Escaneie meu QR Code para acumular pontos!'
                }).catch(err => console.log('Erro ao compartilhar:', err));
            } else {
                alert('Compartilhamento não suportado neste navegador');
            }
        }
        
        function downloadQRCode() {
            const canvas = document.querySelector('#qrcode canvas');
            if (canvas) {
                const link = document.createElement('a');
                link.download = `qrcode-${user.id}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }
        }
    </script>
</body>
</html>


