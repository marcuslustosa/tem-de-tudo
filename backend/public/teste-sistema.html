<!DOCTYPE html>
<html lang="pt-BR">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>?? Teste Sistema - Tem de Tudo</title>
    <script src="/js/config.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #FFFFFF;
            color: #1D1D1F;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 32px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .status {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            border-radius: 12px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        .status.online { background: rgba(76, 175, 80, 0.1); border-color: rgba(76, 175, 80, 0.5); }
        .status.offline { background: rgba(244, 67, 54, 0.1); border-color: rgba(244, 67, 54, 0.5); }
        
        .section {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .section h2 {
            margin-bottom: 16px;
            font-size: 20px;
            color: #667eea;
        }
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #1D1D1F;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
        }
        .result {
            background: rgba(0,0,0,0.4);
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
        .warning { color: #ff9800; }
        
        .credential {
            background: rgba(102, 126, 234, 0.1);
            padding: 10px 14px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 3px solid #667eea;
            font-size: 14px;
        }
        .credential strong {
            color: #667eea;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: #1D1D1F;
            font-size: 14px;
            margin-bottom: 12px;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
    <script src="/js/config.js"></script>
    <script src="/js/auth-manager.js" defer></script>
    <script src="/js/api-client.js" defer></script>
    <script src="/js/validators.js" defer></script>
    <script src="/js/ui-helpers.js" defer></script>
    <script src="/js/auth-guard.js" data-require-auth="cliente"></script>
        <link rel="stylesheet" href="/css/global-unified.css">
    <link rel="stylesheet" href="/css/theme-escuro.css">`n</head>
<body>
    <div class="container">
        <h1>?? Painel de Testes - Sistema</h1>
        <div id="statusBar" class="status">
            <strong id="statusText">? Verificando servidor...</strong><br>
            <span id="apiUrl" style="font-size: 12px; opacity: 0.8;"></span>
        </div>

        <!-- 1. TESTE DE CONEXÃO -->
        <div class="section">
            <h2>1?? Teste de Conexão</h2>
            <button class="btn" onclick="testConnection()">?? Testar Conexão com API</button>
            <div id="connectionResult" class="result" style="display: none;"></div>
        </div>

        <!-- 2. TESTE DE LOGIN -->
        <div class="section">
            <h2>2?? Teste de Login</h2>
            <input type="email" id="loginEmail" placeholder="Email" value="cliente1@email.com">
            <input type="password" id="loginPassword" placeholder="Senha" value="senha123">
            <button class="btn" onclick="testLogin()">?? Fazer Login</button>
            
            <div class="grid" style="margin-top: 10px;">
                <button class="btn btn-secondary" onclick="setCredentials('admin@temdetudo.com', 'admin123')">?? Admin</button>
                <button class="btn btn-secondary" onclick="setCredentials('cliente@teste.com', '123456')">?? Cliente</button>
                <button class="btn btn-secondary" onclick="setCredentials('empresa@teste.com', '123456')">?? Empresa</button>
                <button class="btn btn-secondary" onclick="setCredentials('cliente1@email.com', 'senha123')">?? Cliente 1</button>
            </div>
            
            <div id="loginResult" class="result" style="display: none;"></div>
        </div>

        <!-- 3. TESTE DE EMPRESAS -->
        <div class="section">
            <h2>3?? Listar Empresas (Autenticado)</h2>
            <button class="btn" onclick="testEmpresas()">?? Buscar Empresas</button>
            <div id="empresasResult" class="result" style="display: none;"></div>
        </div>

        <!-- 4. TESTE DE CADASTRO -->
        <div class="section">
            <h2>4?? Teste de Cadastro</h2>
            <input type="text" id="regName" placeholder="Nome Completo" value="Teste Usuario">
            <input type="email" id="regEmail" placeholder="Email" value="teste@email.com">
            <input type="tel" id="regPhone" placeholder="Telefone" value="(11) 99999-9999">
            <input type="text" id="regCpf" placeholder="CPF" value="123.456.789-00">
            <input type="password" id="regPassword" placeholder="Senha" value="123456">
            <button class="btn" onclick="testRegister()">?? Cadastrar</button>
            <div id="registerResult" class="result" style="display: none;"></div>
        </div>

        <!-- 5. CREDENCIAIS DISPONÍVEIS -->
        <div class="section">
            <h2>5?? Credenciais de Teste</h2>
            <div class="credential">
                <strong>Admin:</strong> admin@temdetudo.com / admin123
            </div>
            <div class="credential">
                <strong>Cliente:</strong> cliente@teste.com / 123456
            </div>
            <div class="credential">
                <strong>Empresa:</strong> empresa@teste.com / 123456
            </div>
            <div class="credential">
                <strong>Cliente 1-50:</strong> cliente1@email.com até cliente50@email.com / senha123
            </div>
        </div>
    </div>

    <script>
        // Verificar status do servidor ao carregar
        window.addEventListener('load', async () => {
            document.getElementById('apiUrl').textContent = `API: ${API_CONFIG.getBaseURL()}`;
            const isOnline = await API_CONFIG.checkHealth();
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            
            if (isOnline) {
                statusBar.className = 'status online';
                statusText.innerHTML = '? Servidor ONLINE e funcionando!';
            } else {
                statusBar.className = 'status offline';
                statusText.innerHTML = '? Servidor OFFLINE ou com erro';
            }
        });

        function setCredentials(email, password) {
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = password;
        }

        async function testConnection() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">? Testando conexão...</span>';
            
            try {
                const response = await fetch(API_CONFIG.debug);
                const data = await response.json();
                
                if (response.ok && data.status === 'OK') {
                    resultDiv.innerHTML = `
                        <span class="success">? SUCESSO! Servidor respondendo</span><br><br>
                        <strong>Status:</strong> ${data.status}<br>
                        <strong>Mensagem:</strong> ${data.message}<br>
                        <strong>Banco de Dados:</strong> ${data.database.connection} (${data.database.status})<br>
                        <strong>Ambiente:</strong> ${data.environment}<br>
                        <strong>Timestamp:</strong> ${data.timestamp}
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="warning">?? Resposta inesperada:</span><br><pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">? ERRO ao conectar:</span><br>${error.message}`;
            }
        }

        async function testLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const resultDiv = document.getElementById('loginResult');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">? Fazendo login...</span>';
            
            try {
                const response = await fetch(API_CONFIG.login, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    localStorage.setItem('token', data.data.token);
                    localStorage.setItem('user', JSON.stringify(data.data.user));
                    
                    resultDiv.innerHTML = `
                        <span class="success">? LOGIN SUCESSO!</span><br><br>
                        <strong>Nome:</strong> ${data.data.user.name}<br>
                        <strong>Email:</strong> ${data.data.user.email}<br>
                        <strong>Tipo:</strong> ${data.data.user.perfil || data.data.user.user_type}<br>
                        <strong>Token:</strong> ${data.data.token.substring(0, 40)}...<br>
                        <strong>Pontos:</strong> ${data.data.user.pontos || 0}
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">? ERRO no login:</span><br>${data.message || 'Credenciais inválidas'}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">? ERRO:</span><br>${error.message}`;
            }
        }

        async function testEmpresas() {
            const resultDiv = document.getElementById('empresasResult');
            const token = localStorage.getItem('token');
            
            if (!token) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = '<span class="warning">?? Faça login primeiro!</span>';
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">? Buscando empresas...</span>';
            
            try {
                const response = await fetch(API_CONFIG.empresas, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const empresas = data.data;
                    let html = `<span class="success">? ${empresas.length} empresas encontradas!</span><br><br>`;
                    
                    empresas.slice(0, 5).forEach((emp, i) => {
                        html += `<strong>${i+1}. ${emp.nome}</strong><br>`;
                        html += `Endereço: ${emp.endereco || 'N/A'}<br>`;
                        html += `Telefone: ${emp.telefone || 'N/A'}<br><br>`;
                    });
                    
                    if (empresas.length > 5) {
                        html += `<span class="info">... e mais ${empresas.length - 5} empresas</span>`;
                    }
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<span class="error">? ERRO:</span><br>${data.message || 'Erro ao buscar empresas'}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">? ERRO:</span><br>${error.message}`;
            }
        }

        async function testRegister() {
            const resultDiv = document.getElementById('registerResult');
            const formData = {
                name: document.getElementById('regName').value,
                email: document.getElementById('regEmail').value,
                phone: document.getElementById('regPhone').value,
                cpf: document.getElementById('regCpf').value.replace(/\D/g, ''),
                password: document.getElementById('regPassword').value,
                perfil: 'cliente'
            };
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="info">? Cadastrando...</span>';
            
            try {
                const response = await fetch(API_CONFIG.register, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.innerHTML = `
                        <span class="success">? CADASTRO SUCESSO!</span><br><br>
                        <strong>Nome:</strong> ${data.data.user.name}<br>
                        <strong>Email:</strong> ${data.data.user.email}<br>
                        <strong>Token:</strong> ${data.data.token.substring(0, 40)}...
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">? ERRO:</span><br>${data.message || JSON.stringify(data)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">? ERRO:</span><br>${error.message}`;
            }
        }
    </script>
</body>
</html>


