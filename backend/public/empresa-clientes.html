<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#6A0DAD">
<title>💼 Clientes - Tem de Tudo</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="js/config.js"></script>
<script src="js/auth-guard.js"></script>
<link rel="manifest" href="/manifest.json">

<body>
<div class="header">
<div class="header-content">
<!-- Logo Section -->
<div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(111, 26, 182, 0.1);">
<i class="fas fa-gem" style="color: #6F1AB6; font-size: 1.2rem;"></i>
<span>Tem de Tudo</span>
<span style="font-size: 0.75rem; color: rgba(255,255,255,0.6); font-weight: 600; margin-left: 8px;">EMPRESA</span>
</div>
<div class="header-top">
<button class="back-btn" onclick="window.history.back()">
<i class="fas fa-arrow-left"></i>
</button>
<div>
<h1>?? Clientes Premium</h1>
<p>Gerencie seus clientes com excel�ncia</p>
</div>
</div>
<div class="search-bar">
<i class="fas fa-search"></i>
<input type="text" placeholder="Buscar cliente..." id="searchInput" onkeyup="filtrarClientes()">
</div>
</div>
</div>
<div class="content">
<div class="stats-row">
<div class="stat-mini">
<div class="stat-mini-value" id="totalClientes">156</div>
<div class="stat-mini-label">Total Clientes</div>
</div>
<div class="stat-mini">
<div class="stat-mini-value" id="clientesAtivos">134</div>
<div class="stat-mini-label">Ativos</div>
</div>
<div class="stat-mini">
<div class="stat-mini-value" id="novosMes">23</div>
<div class="stat-mini-label">Novos/M�s</div>
</div>
<div class="stat-mini">
<div class="stat-mini-value" id="ticketMedio">R$ 387</div>
<div class="stat-mini-label">Ticket M�dio</div>
</div>
</div>
<div class="loading-spinner" id="loadingSpinner">
<div class="spinner"></div>
</div>
<div class="clientes-grid" id="clientesGrid">
<!-- Clientes ser�o carregados aqui dinamicamente -->
</div>
<div class="empty-state" id="emptyState" style="display: none;">
<i class="fas fa-users"></i>
<h3>Nenhum cliente encontrado</h3>
<p>Comece a cadastrar seus primeiros clientes para acompanhar seu crescimento!</p>
</div>
</div>
<button class="fab" onclick="adicionarCliente()">
<i class="fas fa-plus"></i>
</button>
<nav class="bottom-nav">
<div class="nav-items">
<a href="empresa-dashboard.html" class="nav-item">
<i class="fas fa-chart-line"></i>
<span>Dashboard</span>
</a>
<a href="empresa-clientes.html" class="nav-item active">
<i class="fas fa-users"></i>
<span>Clientes</span>
</a>
<a href="empresa-promocoes.html" class="nav-item">
<i class="fas fa-tags"></i>
<span>Promo��es</span>
</a>
<a href="empresa-configuracoes.html" class="nav-item">
<i class="fas fa-cog"></i>
<span>Config</span>
</a>
</div>
</nav>
<script>
        // Dados de exemplo dos clientes
        const clientesExemplo = [
            {
                id: 1,
                nome: "Maria Silva",
                email: "maria@email.com",
                telefone: "(11) 99999-9999",
                status: "ativo",
                totalPedidos: 23,
                totalGasto: 1450.60,
                ultimoPedido: "2024-01-15",
                avatar: "MS"
            },
            {
                id: 2,
                nome: "Jo�o Santos",
                email: "joao@email.com", 
                telefone: "(11) 88888-8888",
                status: "ativo",
                totalPedidos: 31,
                totalGasto: 2340.80,
                ultimoPedido: "2024-01-14",
                avatar: "JS"
            },
            {
                id: 3,
                nome: "Ana Costa",
                email: "ana@email.com",
                telefone: "(11) 77777-7777", 
                status: "inativo",
                totalPedidos: 5,
                totalGasto: 234.50,
                ultimoPedido: "2023-12-20",
                avatar: "AC"
            },
            {
                id: 4,
                nome: "Pedro Lima",
                email: "pedro@email.com",
                telefone: "(11) 66666-6666",
                status: "ativo", 
                totalPedidos: 18,
                totalGasto: 987.30,
                ultimoPedido: "2024-01-13",
                avatar: "PL"
            },
            {
                id: 5,
                nome: "Carla Oliveira",
                email: "carla@email.com",
                telefone: "(11) 55555-5555",
                status: "ativo",
                totalPedidos: 42,
                totalGasto: 3256.90,
                ultimoPedido: "2024-01-16",
                avatar: "CO"
            }
        ];
        let clientesFiltrados = [...clientesExemplo];
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }
        function formatarData(data) {
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }
        function gerarCardCliente(cliente) {
            const statusClass = cliente.status === 'ativo' ? 'status-ativo' : 'status-inativo';
            const statusText = cliente.status === 'ativo' ? 'Ativo' : 'Inativo';
            const statusIcon = cliente.status === 'ativo' ? 'check-circle' : 'times-circle';
            return `
                <div class="cliente-card" data-cliente-id="${cliente.id}">
<div class="cliente-header">
<div style="display: flex; align-items: center;">
<div class="cliente-avatar">${cliente.avatar}</div>
<div class="cliente-info">
<div class="cliente-nome">${cliente.nome}</div>
<div class="cliente-status">
<span class="status-badge ${statusClass}">
<i class="fas fa-${statusIcon}"></i>
                                        ${statusText}
                                    </span>
</div>
</div>
</div>
<div class="cliente-actions">
<button class="action-btn btn-primary" onclick="editarCliente(${cliente.id})" title="Editar Cliente">
<i class="fas fa-edit"></i>
</button>
<button class="action-btn btn-secondary" onclick="verDetalhes(${cliente.id})" title="Ver Detalhes">
<i class="fas fa-eye"></i>
</button>
<button class="action-btn btn-danger" onclick="removerCliente(${cliente.id})" title="Remover Cliente">
<i class="fas fa-trash"></i>
</button>
</div>
</div>
<div class="cliente-stats">
<div class="cliente-stat-item">
<span class="stat-value">${cliente.totalPedidos}</span>
<span class="stat-label">Pedidos</span>
</div>
<div class="cliente-stat-item">
<span class="stat-value">${formatarMoeda(cliente.totalGasto)}</span>
<span class="stat-label">Total Gasto</span>
</div>
<div class="cliente-stat-item">
<span class="stat-value">${formatarData(cliente.ultimoPedido)}</span>
<span class="stat-label">�ltimo Pedido</span>
</div>
</div>
</div>
            `;
        }
        function carregarClientes() {
            const grid = document.getElementById('clientesGrid');
            const emptyState = document.getElementById('emptyState');
            const loadingSpinner = document.getElementById('loadingSpinner');
            loadingSpinner.style.display = 'flex';
            setTimeout(() => {
                if (clientesFiltrados.length === 0) {
                    grid.innerHTML = '';
                    emptyState.style.display = 'block';
                } else {
                    emptyState.style.display = 'none';
                    grid.innerHTML = clientesFiltrados.map(cliente => gerarCardCliente(cliente)).join('');
                }
                loadingSpinner.style.display = 'none';
            }, 1000);
        }
        function filtrarClientes() {
            const termo = document.getElementById('searchInput').value.toLowerCase();
            clientesFiltrados = clientesExemplo.filter(cliente => 
                cliente.nome.toLowerCase().includes(termo) ||
                cliente.email.toLowerCase().includes(termo) ||
                cliente.telefone.includes(termo)
            );
            carregarClientes();
        }
        function editarCliente(id) {
            // Implementar edi��o do cliente
            console.log('Editando cliente:', id);
            alert(`Editando cliente ${id}`);
        }
        function verDetalhes(id) {
            // Implementar visualiza��o de detalhes
            console.log('Ver detalhes:', id);
            alert(`Ver detalhes do cliente ${id}`);
        }
        function removerCliente(id) {
            if (confirm('Tem certeza que deseja remover este cliente?')) {
                // Implementar remo��o do cliente
                console.log('Removendo cliente:', id);
                alert(`Cliente ${id} removido com sucesso!`);
                // Recarregar lista
                carregarClientes();
            }
        }
        function adicionarCliente() {
            // Implementar adi��o de novo cliente
            console.log('Adicionar novo cliente');
            alert('Funcionalidade de adicionar cliente ser� implementada');
        }
        // Carregar clientes ao iniciar a p�gina
        document.addEventListener('DOMContentLoaded', function() {
            carregarClientes();
        });
    </script>
</body>
</html>
            position: relative;
            z-index: 2;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }
        .cliente-avatar {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 900;
            flex-shrink: 0;
        }
        .cliente-info {
            flex: 1;
        }
        .cliente-nome {
            font-size: 17px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        .cliente-email {
            font-size: 13px;
            color: #b0b0b0;
        }
        .cliente-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding-top: 16px;
            border-top: 1px solid rgba(111, 26, 182, 0.1);
        }
        .cliente-stat {
            text-align: center;
        }
        .cliente-stat-value {
            font-size: 18px;
            font-weight: 800;
            color: #6F1AB6;
        }
        .cliente-stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }
        .loading, .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #b0b0b0;
        }
        .loading i, .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        @media (max-width: 480px) {
            .header h1 { font-size: 20px; }
            .cliente-stats { grid-template-columns: 1fr; }
        }
    </style>
<script src="/js/config.js"></script>
<script src="/js/auth-manager.js" defer></script>
<script src="/js/api-client.js" defer></script>
<script src="/js/validators.js" defer></script>
<script src="/js/ui-helpers.js" defer></script>
<script src="/js/auth-guard.js" data-require-auth="empresa"></script>
<body>
<div class="header">
<div class="header-top">
<button class="back-btn" onclick="history.back()">
<i class="fas fa-arrow-left"></i>
</button>
<div>
<h1>Meus Clientes</h1>
<p id="totalInfo">Carregando...</p>
</div>
</div>
<div class="search-bar">
<i class="fas fa-search"></i>
<input type="text" id="searchInput" placeholder="Buscar por nome ou email..." oninput="filterClientes()">
</div>
</div>
<div class="content">
<div class="stats-row">
<div class="stat-mini">
<div class="stat-mini-value" id="totalClientes">0</div>
<div class="stat-mini-label">Total</div>
</div>
<div class="stat-mini">
<div class="stat-mini-value" id="clientesAtivos">0</div>
<div class="stat-mini-label">Ativos</div>
</div>
<div class="stat-mini">
<div class="stat-mini-value" id="pontosTotal">0</div>
<div class="stat-mini-label">Pontos</div>
</div>
</div>
<div id="loading" class="loading">
<i class="fas fa-spinner fa-spin"></i>
<p>Carregando clientes...</p>
</div>
<div id="clientes-grid" class="clientes-grid" style="display: none;"></div>
<div id="empty-state" class="empty-state" style="display: none;">
<i class="fas fa-users"></i>
<p>Nenhum cliente encontrado</p>
</div>
</div>
<script>
        let allClientes = [];
        function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'entrar.html';
                return false;
            }
            return token;
        }
        async function loadClientes() {
            const token = checkAuth();
            if (!token) return;
            try {
                const response = await fetch('/api/empresa/clientes', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });
                if (response.ok) {
                    const result = await response.json();
                    allClientes = result.data || [];
                    console.log('Clientes carregados:', allClientes.length);
                    if (allClientes.length > 0) {
                        renderClientes(allClientes);
                        updateStats();
                    } else {
                        showEmptyState();
                    }
                } else if (response.status === 401) {
                    window.location.href = 'entrar.html';
                } else {
                    console.error('Erro na resposta:', response.status);
                    showEmptyState();
                }
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
                showEmptyState();
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        function updateStats() {
            const totalPontos = allClientes.reduce((sum, c) => sum + (c.total_pontos || 0), 0);
            const clientesAtivos = allClientes.filter(c => (c.total_transacoes || 0) > 0).length;
            document.getElementById('totalClientes').textContent = allClientes.length;
            document.getElementById('clientesAtivos').textContent = clientesAtivos;
            document.getElementById('pontosTotal').textContent = totalPontos.toLocaleString('pt-BR');
            document.getElementById('totalInfo').textContent = `${allClientes.length} ${allClientes.length === 1 ? 'cliente' : 'clientes'}`;
        }
        function renderClientes(clientes) {
            const grid = document.getElementById('clientes-grid');
            grid.innerHTML = clientes.map(cliente => {
                const inicial = (cliente.cliente_nome || 'C')[0].toUpperCase();
                const ultimaVisita = cliente.ultima_visita ? 
                    new Date(cliente.ultima_visita).toLocaleDateString('pt-BR') : 
                    'Nunca';
                return `
                    <div class="cliente-card">
<div class="cliente-header">
<div class="cliente-avatar">${inicial}</div>
<div class="cliente-info">
<div class="cliente-nome">${cliente.cliente_nome}</div>
<div class="cliente-email">${cliente.cliente_email || 'Email n�o informado'}</div>
</div>
</div>
<div class="cliente-stats">
<div class="cliente-stat">
<div class="cliente-stat-value">${cliente.total_pontos || 0}</div>
<div class="cliente-stat-label">Pontos</div>
</div>
<div class="cliente-stat">
<div class="cliente-stat-value">${cliente.total_transacoes || 0}</div>
<div class="cliente-stat-label">Visitas</div>
</div>
<div class="cliente-stat">
<div class="cliente-stat-value" style="font-size: 12px;">${ultimaVisita}</div>
<div class="cliente-stat-label">�ltima</div>
</div>
</div>
</div>
                `;
            }).join('');
            grid.style.display = 'grid';
        }
        function filterClientes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            let filtered = allClientes;
            if (searchTerm) {
                filtered = allClientes.filter(c => {
                    return (c.cliente_nome && c.cliente_nome.toLowerCase().includes(searchTerm)) ||
                           (c.cliente_email && c.cliente_email.toLowerCase().includes(searchTerm));
                });
            }
            if (filtered.length > 0) {
                renderClientes(filtered);
                document.getElementById('empty-state').style.display = 'none';
            } else {
                document.getElementById('clientes-grid').style.display = 'none';
                document.getElementById('empty-state').style.display = 'block';
            }
        }
        function showEmptyState() {
            document.getElementById('empty-state').style.display = 'block';
            document.getElementById('totalInfo').textContent = '0 clientes';
        }
        document.addEventListener('DOMContentLoaded', loadClientes);
    </script>
<!-- Bottom Navigation -->
<nav class="bottom-nav">
<a href="dashboard-empresa-funcional.html" class="nav-item">
<i class="fas fa-home"></i>
<span>Dashboard</span>
</a>
<a href="empresa-scanner.html" class="nav-item">
<i class="fas fa-qrcode"></i>
<span>Scanner</span>
</a>
<a href="empresa-promocoes.html" class="nav-item">
<i class="fas fa-gift"></i>
<span>Promo��es</span>
</a>
<a href="empresa-clientes.html" class="nav-item active">
<i class="fas fa-users"></i>
<span>Clientes</span>
</a>
<a href="empresa-relatorios.html" class="nav-item">
<i class="fas fa-chart-line"></i>
<span>Relat�rios</span>
</a>
</nav>
</body>
</html>
</html>
