<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil - Tem de Tudo</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #1a1a2e; color: #fff; padding-bottom: 80px; }
        .header { background: linear-gradient(135deg, #667eea, #764ba2); padding: 24px 20px 40px; text-align: center; }
        .profile-avatar { width: 80px; height: 80px; background: rgba(255, 255, 255, 0.2); border: 3px solid rgba(255, 255, 255, 0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 36px; }
        .profile-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
        .profile-email { font-size: 13px; opacity: 0.9; }
        .profile-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 16px 20px; margin-top: -20px; }
        .stat-card { background: #2a2a3e; border-radius: 12px; padding: 16px 12px; text-align: center; border: 1px solid rgba(102, 126, 234, 0.1); }
        .stat-value { font-size: 24px; font-weight: 800; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 4px; }
        .stat-label { font-size: 11px; color: #888; }
        .menu-section { padding: 20px; }
        .section-title { font-size: 14px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 12px; padding-left: 4px; }
        .menu-items { background: #2a2a3e; border-radius: 16px; overflow: hidden; border: 1px solid rgba(102, 126, 234, 0.1); }
        .menu-item { padding: 16px; display: flex; align-items: center; gap: 16px; text-decoration: none; color: #fff; border-bottom: 1px solid rgba(255, 255, 255, 0.05); transition: background 0.3s; }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:active { background: rgba(102, 126, 234, 0.1); }
        .menu-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .menu-content { flex: 1; }
        .menu-title { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
        .menu-subtitle { font-size: 12px; color: #888; }
        .menu-arrow { color: #667eea; font-size: 16px; }
        .logout-btn { margin: 20px; background: #2a2a3e; border: 2px solid rgba(255, 59, 48, 0.3); color: #ff3b30; padding: 16px; border-radius: 16px; width: calc(100% - 40px); font-size: 15px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a2e; border-top: 1px solid rgba(102, 126, 234, 0.1); display: flex; justify-content: space-around; padding: 12px 0 8px; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; text-decoration: none; color: #888; font-size: 11px; font-weight: 500; }
        .nav-item.active { color: #667eea; }
        .nav-item i { font-size: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="profile-avatar"><i class="fas fa-user"></i></div>
        <div class="profile-name" id="profileName">Carregando...</div>
        <div class="profile-email" id="profileEmail">...</div>
    </div>
    <div class="profile-stats">
        <div class="stat-card"><div class="stat-value" id="statPontos">0</div><div class="stat-label">Pontos</div></div>
        <div class="stat-card"><div class="stat-value" id="statCheckins">0</div><div class="stat-label">Check-ins</div></div>
        <div class="stat-card"><div class="stat-value" id="statCupons">0</div><div class="stat-label">Cupons</div></div>
    </div>
    <div class="menu-section">
        <div class="section-title">Conta</div>
        <div class="menu-items">
            <a href="/app-editar-perfil.html" class="menu-item"><div class="menu-icon"><i class="fas fa-user-edit"></i></div><div class="menu-content"><div class="menu-title">Editar Perfil</div><div class="menu-subtitle">Nome, email, telefone</div></div><i class="fas fa-chevron-right menu-arrow"></i></a>
            <a href="/app-meus-pontos.html" class="menu-item"><div class="menu-icon"><i class="fas fa-wallet"></i></div><div class="menu-content"><div class="menu-title">Meus Pontos</div><div class="menu-subtitle">Histórico e saldo</div></div><i class="fas fa-chevron-right menu-arrow"></i></a>
            <a href="/app-meus-cupons.html" class="menu-item"><div class="menu-icon"><i class="fas fa-ticket-alt"></i></div><div class="menu-content"><div class="menu-title">Meus Cupons</div><div class="menu-subtitle">Cupons ativos e usados</div></div><i class="fas fa-chevron-right menu-arrow"></i></a>
        </div>
    </div>
    <div class="menu-section">
        <div class="section-title">Configurações</div>
        <div class="menu-items">
            <a href="/app-notificacoes.html" class="menu-item"><div class="menu-icon"><i class="fas fa-bell"></i></div><div class="menu-content"><div class="menu-title">Notificações</div><div class="menu-subtitle">Gerencie alertas</div></div><i class="fas fa-chevron-right menu-arrow"></i></a>
            <a href="/app-ajuda.html" class="menu-item"><div class="menu-icon"><i class="fas fa-question-circle"></i></div><div class="menu-content"><div class="menu-title">Ajuda</div><div class="menu-subtitle">FAQ e suporte</div></div><i class="fas fa-chevron-right menu-arrow"></i></a>
            <a href="/app-termos.html" class="menu-item"><div class="menu-icon"><i class="fas fa-file-alt"></i></div><div class="menu-content"><div class="menu-title">Termos de Uso</div><div class="menu-subtitle">Políticas e privacidade</div></div><i class="fas fa-chevron-right menu-arrow"></i></a>
        </div>
    </div>
    <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i>Sair da Conta</button>
    <nav class="bottom-nav">
        <a href="/app-inicio.html" class="nav-item"><i class="fas fa-home"></i><span>Início</span></a>
        <a href="/app-scanner.html" class="nav-item"><i class="fas fa-qrcode"></i><span>Scanner</span></a>
        <a href="/app-meus-pontos.html" class="nav-item"><i class="fas fa-wallet"></i><span>Meus pontos</span></a>
        <a href="/app-empresas.html" class="nav-item"><i class="fas fa-store"></i><span>Empresas</span></a>
        <a href="/app-perfil.html" class="nav-item active"><i class="fas fa-user"></i><span>Perfil</span></a>
    </nav>
    <script>
        const API_BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:8000' : 'https://tem-de-tudo.onrender.com';
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            if (!token || !userStr) { window.location.href = '/entrar.html'; return; }
            try {
                const user = JSON.parse(userStr);
                document.getElementById('profileName').textContent = user.name || user.nome || 'Usuário';
                document.getElementById('profileEmail').textContent = user.email || 'email@exemplo.com';
                const response = await fetch(`${API_BASE_URL}/api/perfil`, { headers: { 'Authorization': `Bearer ${token}` } });
                const data = await response.json();
                if (data.success && data.data) {
                    document.getElementById('statPontos').textContent = data.data.pontos || 0;
                    const histResponse = await fetch(`${API_BASE_URL}/api/historico`, { headers: { 'Authorization': `Bearer ${token}` } });
                    const histData = await histResponse.json();
                    if (histData.success && histData.data) { document.getElementById('statCheckins').textContent = histData.data.filter(h => h.tipo === 'checkin').length; }
                    const cuponsResponse = await fetch(`${API_BASE_URL}/api/cupons`, { headers: { 'Authorization': `Bearer ${token}` } });
                    const cuponsData = await cuponsResponse.json();
                    if (cuponsData.success && cuponsData.data) { document.getElementById('statCupons').textContent = cuponsData.data.length; }
                }
            } catch (error) { console.error('Erro:', error); }
        });
        function logout() { if (confirm('Tem certeza que deseja sair?')) { localStorage.removeItem('token'); localStorage.removeItem('user'); window.location.href = '/entrar.html'; } }
    </script>
</body>
</html>
