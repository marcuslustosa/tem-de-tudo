<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Cupons - Tem de Tudo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/css/vale-bonus-theme.css">
</head>
<body>
    <div class="header">
        <button class="back-btn" onclick="history.back()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); width: 44px; height: 44px; border-radius: 12px; color: white; font-size: 18px; cursor: pointer; margin-bottom: 16px;">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 style="font-size: 28px; font-weight: 800; margin-bottom: 8px;">Meus Cupons</h1>
        <p style="color: #b0b0b0; font-size: 14px;">Resgate e economize</p>
    </div>
    
    <div style="padding: 20px;">
        <!-- Tabs -->
        <div class="tabs" style="display: flex; gap: 12px; margin-bottom: 24px; background: #2a2a3e; border-radius: 16px; padding: 6px;">
            <button class="tab active" data-tab="shop" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 12px; color: white; font-weight: 700; cursor: pointer;">
                Shop
            </button>
            <button class="tab" data-tab="meus" style="flex: 1; padding: 12px; background: transparent; border: none; border-radius: 12px; color: #888; font-weight: 700; cursor: pointer;">
                Meus Cupons
            </button>
        </div>
        
        <!-- Shop de Cupons (comprar com pontos) -->
        <div id="tab-shop" class="tab-content">
            <div class="pontos-info" style="background: linear-gradient(135deg, #f39c12, #e67e22); padding: 16px; border-radius: 16px; margin-bottom: 20px; text-align: center;">
                <div style="font-size: 24px; font-weight: 800; margin-bottom: 4px;" id="pontosUser">250 pontos</div>
                <div style="font-size: 14px; opacity: 0.9;">Seus pontos dispon√≠veis</div>
            </div>
            
            <div class="cupons-grid" id="cuponsShop">
                <!-- Ser√° preenchido via JavaScript -->
            </div>
        </div>
        
        <!-- Meus Cupons -->
        <div id="tab-meus" class="tab-content" style="display: none;">
            <div class="cupons-grid" id="cuponsDisponiveis">
                <!-- Ser√° preenchido via JavaScript -->
            </div>
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none; text-align: center; padding: 60px 20px; color: #666;">
            <i class="fas fa-ticket-alt" style="font-size: 64px; margin-bottom: 16px; opacity: 0.3;"></i>
            <p style="font-size: 16px; font-weight: 600;">Nenhum cupom encontrado</p>
            <p style="font-size: 14px; margin-top: 8px;">Visite empresas parceiras para ganhar cupons</p>
        </div>
    </div>
    
    <nav class="bottom-nav">
        <a href="app-inicio.html" class="nav-item"><i class="fas fa-home"></i><span>In√≠cio</span></a>
        <a href="app-empresas.html" class="nav-item"><i class="fas fa-search"></i><span>Buscar</span></a>
        <a href="app-cupons.html" class="nav-item active"><i class="fas fa-ticket-alt"></i><span>Cupons</span></a>
        <a href="app-notificacoes.html" class="nav-item"><i class="fas fa-bell"></i><span>Avisos</span></a>
        <a href="app-perfil.html" class="nav-item"><i class="fas fa-user"></i><span>Perfil</span></a>
    </nav>
    
    <script>
        const API_BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:8001' : 'https://tem-de-tudo.onrender.com';
        
        // Dados fict√≠cios para usu√°rios de DEMONSTRA√á√ÉO
        const cuponsDisponivelsFicticios = [
            { id: 1, empresa: 'Sabor e Arte', desconto: '20% OFF', descricao: 'Em qualquer prato', validade: '2026-03-31', codigo: 'SABOR20', usado: false },
            { id: 2, empresa: 'Bella Napoli', desconto: 'R$ 15 OFF', descricao: 'Pizza grande', validade: '2026-02-28', codigo: 'PIZZA15', usado: false },
            { id: 3, empresa: 'Academia FitLife', desconto: '1 m√™s gr√°tis', descricao: 'Na matr√≠cula anual', validade: '2026-04-30', codigo: 'FIT1MES', usado: false }
        ];
        
        const cuponsUsadosFicticios = [
            { id: 4, empresa: 'Caf√© & Cia', desconto: 'R$ 5 OFF', descricao: 'Em qualquer bebida', validade: '2026-01-31', codigo: 'CAFE5', usado: true, dataUso: '2026-01-15' }
        ];
        
        let cuponsDisponiveis = [];
        let cuponsUsados = [];
        let tabAtual = 'disponiveis';
        
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/entrar.html';
                return;
            }
            
            // Verificar se √© usu√°rio FICT√çCIO (demonstra√ß√£o) ou REAL (uso)
            const userStr = localStorage.getItem('user');
            const usuariosFicticios = ['maria@email.com', 'joao@email.com', 'saborearte@email.com', 'bellanapoli@email.com'];
            let ehUsuarioFicticio = false;
            
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    ehUsuarioFicticio = usuariosFicticios.includes(user.email);
                } catch (e) {
                    console.error('Erro ao parsear user:', e);
                }
            }
            
            if (ehUsuarioFicticio) {
                console.log('üë§ Usu√°rio fict√≠cio: usando dados de demonstra√ß√£o');
                cuponsDisponiveis = cuponsDisponivelsFicticios;
                cuponsUsados = cuponsUsadosFicticios;
                renderizarCupons();
            } else {
                console.log('üî• Usu√°rio real: carregando cupons reais da API');
                carregarCuponsAPI();
            }
            }
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                        t.style.background = 'transparent';
                        t.style.color = '#888';
                    });
                    tab.classList.add('active');
                    tab.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                    tab.style.color = 'white';
                    
                    const targetTab = tab.dataset.tab;
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    document.getElementById(`tab-${targetTab}`).style.display = 'block';
                });
            });
        });
        
        function renderizarCupons() {
            const gridDisponiveis = document.getElementById('cuponsDisponiveis');
            const gridUsados = document.getElementById('cuponsUsados');
            const empty = document.getElementById('emptyState');
            
            if (cuponsDisponiveis.length === 0 && cuponsUsados.length === 0) {
                empty.style.display = 'block';
                return;
            }
            
            gridDisponiveis.innerHTML = cuponsDisponiveis.map(cupom => `
                <div class="card" style="padding: 20px; margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 18px; font-weight: 700; color: #667eea; margin-bottom: 4px;">${cupom.desconto}</div>
                            <div style="font-size: 14px; color: #bbb;">${cupom.empresa}</div>
                        </div>
                        <div class="badge" style="background: linear-gradient(135deg, #f39c12, #e67e22); padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 700;">
                            V√°lido
                        </div>
                    </div>
                    <p style="font-size: 14px; color: #888; margin-bottom: 12px;">${cupom.descricao}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 12px; color: #666;">
                            <i class="fas fa-calendar"></i> At√© ${new Date(cupom.validade).toLocaleDateString('pt-BR')}
                        </div>
                        <button class="btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="usarCupom(${cupom.id})">
                            <i class="fas fa-check"></i> Usar
                        </button>
                    </div>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px dashed rgba(102, 126, 234, 0.2); font-size: 12px; color: #667eea; font-weight: 700; letter-spacing: 2px;">
                        ${cupom.codigo}
                    </div>
                </div>
            `).join('');
            
            gridUsados.innerHTML = cuponsUsados.map(cupom => `
                <div class="card" style="padding: 20px; margin-bottom: 16px; opacity: 0.5;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 18px; font-weight: 700; color: #888; margin-bottom: 4px;">${cupom.desconto}</div>
                            <div style="font-size: 14px; color: #666;">${cupom.empresa}</div>
                        </div>
                        <div class="badge" style="background: #2a2a3e; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; color: #666;">
                            Usado
                        </div>
                    </div>
                    <p style="font-size: 14px; color: #666; margin-bottom: 12px;">${cupom.descricao}</p>
                    <div style="font-size: 12px; color: #555;">
                        <i class="fas fa-check-circle"></i> Usado em ${new Date(cupom.dataUso).toLocaleDateString('pt-BR')}
                    </div>
                </div>
            `).join('');
        }
        
        async function carregarCuponsAPI() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_BASE_URL}/api/cupons`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (data.success && data.data) {
                    // Processar cupons da API
                    console.log('Cupons da API:', data.data);
                }
            } catch (error) {
                console.error('Erro ao carregar cupons:', error);
                document.getElementById('emptyState').style.display = 'block';
            }
        }
        
        function usarCupom(id) {
            if (confirm('Tem certeza que deseja usar este cupom?')) {
                alert('Cupom usado com sucesso! Apresente o c√≥digo no estabelecimento.');
                // Mover para usados
                const cupom = cuponsDisponiveis.find(c => c.id === id);
                if (cupom) {
                    cupom.usado = true;
                    cupom.dataUso = new Date().toISOString().split('T')[0];
                    cuponsUsados.push(cupom);
                    cuponsDisponiveis.splice(cuponsDisponiveis.findIndex(c => c.id === id), 1);
                    renderizarCupons();
                }
            }
        }
    </script>
</body>
</html>

