<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - TemDeTudo</title>
    <meta name="description" content="Cadastre-se no TemDeTudo e ganhe pontos em suas compras">
    <meta name="theme-color" content="#4c1d95">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <link rel="icon" type="image/png" href="/img/logo.png">
    <link rel="stylesheet" href="/css/modern-theme.css">
</head>
<body style="background: linear-gradient(135deg, #1f2937 0%, #374151 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
    
    <div class="register-container" style="width: 100%; max-width: 500px; margin: 2rem;">
        <div class="card" style="border: none; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);">
            
            <div class="card-header text-center" style="background: var(--gradient-primary); padding: var(--space-8);">
                <div style="margin-bottom: 1.5rem;">
                    <img src="/img/logo.png" alt="TemDeTudo" style="width: 64px; height: 64px; border-radius: var(--radius-full); border: 3px solid white;">
                </div>
                <h1 style="color: white; font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem;">Criar conta</h1>
                <p style="color: rgba(255,255,255,0.9); font-size: 0.875rem;">Cadastre-se e ganhe 100 pontos de bônus!</p>
            </div>
            
            <div class="card-body" style="padding: var(--space-8);">
                <form id="registerForm" onsubmit="handleRegister(event)">
                    
                    <div class="form-group" style="margin-bottom: var(--space-6);">
                        <label for="name" class="form-label">
                            <i class="fas fa-user icon-sm"></i> Nome completo
                        </label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            class="form-control" 
                            placeholder="Seu nome completo"
                            required
                            autocomplete="name"
                        >
                    </div>
                    
                    <div class="form-group" style="margin-bottom: var(--space-6);">
                        <label for="email" class="form-label">
                            <i class="fas fa-envelope icon-sm"></i> Email
                        </label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-control" 
                            placeholder="seu@email.com"
                            required
                            autocomplete="username"
                        >
                    </div>
                    
                    <div class="form-group" style="margin-bottom: var(--space-6);">
                        <label for="phone" class="form-label">
                            <i class="fas fa-phone icon-sm"></i> Telefone (opcional)
                        </label>
                        <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            class="form-control" 
                            placeholder="(11) 99999-9999"
                            autocomplete="tel"
                        >
                    </div>
                    
                    <div class="form-group" style="margin-bottom: var(--space-6);">
                        <label for="password" class="form-label">
                            <i class="fas fa-lock icon-sm"></i> Senha
                        </label>
                        <div style="position: relative;">
                            <input 
                                type="password" 
                                id="password" 
                                name="password" 
                                class="form-control" 
                                placeholder=""
                                required
                                autocomplete="new-password"
                                minlength="8"
                            >
                            <button 
                                type="button" 
                                onclick="togglePasswordVisibility('password')" 
                                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--gray-500); cursor: pointer;"
                            >
                                <i id="passwordToggleIcon" class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small style="color: var(--gray-600); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                            Mínimo de 8 caracteres
                        </small>
                    </div>

                    <div class="form-group" style="margin-bottom: var(--space-6);">
                        <label for="password_confirmation" class="form-label">
                            <i class="fas fa-lock icon-sm"></i> Confirmar senha
                        </label>
                        <div style="position: relative;">
                            <input 
                                type="password" 
                                id="password_confirmation" 
                                name="password_confirmation" 
                                class="form-control" 
                                placeholder=""
                                required
                                autocomplete="new-password"
                            >
                            <button 
                                type="button" 
                                onclick="togglePasswordVisibility('password_confirmation')" 
                                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--gray-500); cursor: pointer;"
                            >
                                <i id="confirmPasswordToggleIcon" class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group" style="margin-bottom: var(--space-6);">
                        <label style="display: flex; align-items: flex-start; cursor: pointer; font-size: 0.875rem; color: var(--gray-600); line-height: 1.5;">
                            <input 
                                type="checkbox" 
                                id="terms" 
                                name="terms" 
                                required
                                style="margin-right: 12px; margin-top: 4px; flex-shrink: 0; width: 16px; height: 16px;"
                            >
                            <span>
                                Eu concordo com os 
                                <a href="/privacidade.html" target="_blank" style="color: var(--primary-color); text-decoration: none;">
                                    termos de uso e política de privacidade
                                </a>
                            </span>
                        </label>
                    </div>

                    <button 
                        type="submit" 
                        class="btn btn-primary" 
                        id="registerBtn"
                        style="width: 100%; padding: 0.875rem; font-weight: 600; border-radius: var(--border-radius); margin-bottom: var(--space-4);"
                    >
                        <i class="fas fa-user-plus" style="margin-right: 0.5rem;"></i>
                        Criar conta
                    </button>

                    <div style="text-align: center; margin: var(--space-6) 0;">
                        <span style="color: var(--gray-500); font-size: 0.875rem; background: white; padding: 0 1rem; position: relative;">
                            ou
                        </span>
                        <hr style="border: none; height: 1px; background: var(--gray-200); margin-top: -0.6rem; z-index: -1;">
                    </div>

                    <div style="text-align: center;">
                        <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: var(--space-4);">
                            Já tem uma conta?
                        </p>
                        <a 
                            href="/login.html" 
                            class="btn btn-outline-primary" 
                            style="width: 100%; padding: 0.875rem; font-weight: 600; border-radius: var(--border-radius);"
                        >
                            <i class="fas fa-sign-in-alt" style="margin-right: 0.5rem;"></i>
                            Fazer login
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <div style="text-align: center; margin-top: var(--space-6);">
            <a href="/index.html" style="color: rgba(255,255,255,0.8); text-decoration: none; font-size: 0.875rem;">
                <i class="fas fa-arrow-left" style="margin-right: 0.5rem;"></i>
                Voltar ao início
            </a>
        </div>
    </div>

    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: white; padding: 2rem; border-radius: var(--border-radius); text-align: center;">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
            <p>Criando sua conta...</p>
        </div>
    </div>

    <div id="messageContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10000;"></div>

    <script>
        function togglePasswordVisibility(fieldId) {
            const passwordInput = document.getElementById(fieldId);
            const toggleIcon = document.getElementById(fieldId === 'password' ? 'passwordToggleIcon' : 'confirmPasswordToggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye';
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const registerBtn = document.getElementById('registerBtn');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            const password = formData.get('password');
            const passwordConfirmation = formData.get('password_confirmation');
            
            if (password !== passwordConfirmation) {
                showMessage('As senhas não coincidem', 'error');
                return;
            }
            
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i>Criando conta...';
            loadingOverlay.style.display = 'flex';
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        name: formData.get('name'),
                        email: formData.get('email'),
                        phone: formData.get('phone'),
                        password: password,
                        password_confirmation: passwordConfirmation,
                        terms: formData.get('terms') ? true : false
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    if (data.data && data.data.token) {
                        localStorage.setItem('token', data.data.token);
                        localStorage.setItem('user', JSON.stringify(data.data.user));
                    }
                    
                    showMessage(data.message || 'Conta criada com sucesso! Você ganhou 100 pontos de bônus!', 'success');
                    
                    setTimeout(() => {
                        window.location.href = data.data && data.data.token ? '/pontos.html' : '/login.html';
                    }, 2000);
                } else {
                    throw new Error(data.message || 'Erro ao criar conta');
                }
            } catch (error) {
                console.error('Erro no cadastro:', error);
                showMessage(error.message || 'Erro ao criar conta. Tente novamente.', 'error');
            } finally {
                registerBtn.disabled = false;
                registerBtn.innerHTML = '<i class="fas fa-user-plus" style="margin-right: 0.5rem;"></i>Criar conta';
                loadingOverlay.style.display = 'none';
            }
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            
            const bgColor = type === 'success' ? '#22c55e' : 
                           type === 'error' ? '#ef4444' : '#3b82f6';
            
            messageDiv.style.cssText = `
                background: ${bgColor};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                margin-bottom: 0.5rem;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}" style="margin-right: 0.5rem;"></i>
                ${message}
            `;
            
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 7) {
                value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            }
            e.target.value = value;
        });

        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
